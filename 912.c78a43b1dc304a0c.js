"use strict";(self.webpackChunkalojamiento_frontend=self.webpackChunkalojamiento_frontend||[]).push([[912],{2317:(C,_,s)=>{s.d(_,{U:()=>h});var o=s(5551),a=s(8463),d=s(1571),p=s(4833);let h=(()=>{class t extends a.O{constructor(n){super(),this.productSalesRepo=n,this.router=o.J.ProductoVentas}getAll(n){return this.productSalesRepo.getAll(this.router,n)}getById(n){return this.productSalesRepo.getById(this.router,n)}create(n){return this.productSalesRepo.create(this.router,n)}update(n,c){return this.productSalesRepo.updateTypeServices(this.router,n,c)}remove(n){return this.productSalesRepo.remove(this.router,n)}}return t.\u0275fac=function(n){return new(n||t)(d.LFG(p._))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},6891:(C,_,s)=>{s.d(_,{s:()=>h});var o=s(5551),a=s(8463),d=s(1571),p=s(4833);let h=(()=>{class t extends a.O{constructor(n){super(),this.productsRepo=n,this.router=o.J.Productos}getAll(n){return this.productsRepo.getAll(this.router,n)}getById(n){return this.productsRepo.getById(this.router,n)}create(n){return this.productsRepo.create(this.router,n)}update(n,c){return this.productsRepo.updateTypeServices(this.router,n,c)}remove(n){return this.productsRepo.remove(this.router,n)}}return t.\u0275fac=function(n){return new(n||t)(d.LFG(p._))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},8278:(C,_,s)=>{s.d(_,{E:()=>h});var o=s(5551),a=s(8463),d=s(1571),p=s(4833);let h=(()=>{class t extends a.O{constructor(n){super(),this.shoppingRepo=n,this.router=o.J.Recervaciones}getAll(n){return this.shoppingRepo.getAll(this.router,n)}getById(n){return this.shoppingRepo.getById(this.router,n)}create(n){return this.shoppingRepo.create(this.router,n)}update(n,c){return this.shoppingRepo.updateTypeServices(this.router,n,c)}remove(n){return this.shoppingRepo.remove(this.router,n)}}return t.\u0275fac=function(n){return new(n||t)(d.LFG(p._))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},2903:(C,_,s)=>{s.d(_,{M:()=>h});var o=s(5551),a=s(8463),d=s(1571),p=s(4833);let h=(()=>{class t extends a.O{constructor(n){super(),this.salesRepo=n,this.router=o.J.Ventas}getAll(n){return this.salesRepo.getAll(this.router,n)}getById(n){return this.salesRepo.getById(this.router,n)}getAllVentaClientesById(n,c){return this.salesRepo.getById02(`${this.router}/getVentaCliente`,n,c)}create(n){return this.salesRepo.create(this.router,n)}update(n,c){return this.salesRepo.updateTypeServices(this.router,n,c)}remove(n){return this.salesRepo.remove(this.router,n)}}return t.\u0275fac=function(n){return new(n||t)(d.LFG(p._))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},3947:(C,_,s)=>{s.d(_,{W:()=>O});var o=s(9671),a=s(4006),d=s(168),p=s(8268),h=s(4553),t=s(1571),f=s(388),n=s(6891),c=s(6895),T=s(2317),m=s(8278),g=s(2903),S=s(8796),I=s(312),b=s(4576),y=s(7597),M=s(7209);let O=(()=>{class u extends p.nh{constructor(e,r,i,l,E,P,D,A){super(),this.modalRef=e,this.fb=r,this.productsService=i,this.datePipe=l,this.productSalesService=E,this.reservationsService=P,this.currencyPipe=D,this.salesService=A,this.form=new a.cw({}),this.title="PRODUCTO COMPRA",this.status="Nuevo",this.edit=!1,this.maxDate=new Date,this.idSale=0,this.reservations=new h.b,this.products=new h.b}get saleId(){return this.form.get("ventaId")}ngOnInit(){this.prepareForm()}prepareForm(){this.form=this.fb.group({precioTotal:[null,[a.kI.required]],productoId:[null,[a.kI.required]],ventaId:[null,[a.kI.required]],cantidad:[null,[a.kI.required]],precioUni:[null,[a.kI.required]]}),this.form.controls.ventaId.disable(),this.form.controls.precioUni.disable(),this.form.controls.precioTotal.disable(),null!=this.productSales?(this.edit=!0,this.form.patchValue(this.productSales),this.previouStart(this.idSale),console.log(this.idSale)):(this.previouStart(this.idSale),console.log(this.idSale)),setTimeout(()=>{this.getSales(new d.NV),this.getProducts(new d.NV)},100)}previouStart(e){var r=this;return(0,o.Z)(function*(){r.DateSale=yield r.validSales(e);let i=r.DateSale[0].id;console.log(i);const l=new Date(i);r.datePipe.transform(new Date(l.getTime()+6e4*l.getTimezoneOffset()),"dd/MM/yyyy"),r.saleId.setValue(i)})()}validSales(e){var r=this;return(0,o.Z)(function*(){const i=new d.NV;return i["filter.id"]=`$eq:${e}`,new Promise((l,E)=>{r.salesService.getAll(i).subscribe({next:P=>{l(P.data)},error:P=>{l(0)}})})})()}confirm(){this.edit?this.update():this.create()}create(){this.loading=!0;let e={productoId:Number(this.form.controls.productoId.getRawValue()),ventaId:Number(this.form.controls.ventaId.getRawValue()),precioTotal:this.form.controls.precioTotal.getRawValue(),cantidad:Number(this.form.controls.cantidad.getRawValue()),precioUni:this.form.controls.precioUni.getRawValue()};this.productSalesService.create(e).subscribe({next:r=>{this.handleSuccess(),this.loading=!1},error:r=>{this.loading=!1}})}handleSuccess(){this.alert("success",this.title,(this.edit?"Actualizada":"Guardada")+" Correctamente"),this.loading=!1,this.modalRef.content.callback(!0),this.modalRef.hide()}update(){if(this.productSales){this.loading=!0;let e={productoId:Number(this.form.controls.productoId.getRawValue()),ventaId:Number(this.form.controls.ventaId.getRawValue()),precioVenta:this.form.controls.precioVenta.getRawValue()};this.productSalesService.update(this.productSales.id,e).subscribe({next:r=>{this.loading=!1,this.handleSuccess()},error:r=>{this.loading=!1}})}}close(){this.modalRef.hide()}getSales(e){var r=this;this.sales&&(e["filter.id"]=`$eq:${this.sales.id}`),this.salesService.getAll(e).subscribe({next:i=>{this.result=i.data.map(function(){var l=(0,o.Z)(function*(E){const P=new Date(E.fecha),D=r.datePipe.transform(new Date(P.getTime()+6e4*P.getTimezoneOffset()),"dd/MM/yyyy");console.log(D),E.idSales=E.id+" - "+D});return function(E){return l.apply(this,arguments)}}()),this.reservations=new h.b(i.data,i.count)},error:i=>{this.reservations=new h.b,this.loading=!1}})}onChangeReservations(e){console.log(e)}validateDate(e){e&&(this.editDate=e)}getProducts(e){e.text&&(e["filter.nombre"]=`$ilike:${e.text}`),this.productsService.getAll(e).subscribe({next:r=>{this.result1=r.data.map(function(){var i=(0,o.Z)(function*(l){l.product=l.nombre+" - "+l.precio});return function(l){return i.apply(this,arguments)}}()),this.products=new h.b(r.data,r.count)},error:r=>{this.products=new h.b,this.loading=!1}})}onChangeProducts(e){console.log(e.precio);const r=this.form.controls.cantidad.getRawValue();if(e.precio&&(this.price=e.precio,this.form.controls.precioUni.setValue(e.precio)),e.precio&&r){const i=this.addCurrency(r,e.precio),l=this.formatToBolivianCurrency(i);this.form.controls.precioTotal.setValue(l)}}onChangeAmount(e){console.log(e);const r=this.form.controls.precioUni.getRawValue();if(e&&r){const i=this.addCurrency(e,r),l=this.formatToBolivianCurrency(i);this.form.controls.precioTotal.setValue(l)}}addCurrency(e,r){return Number(e)*parseFloat(r.replace("Bs ",""))}formatToBolivianCurrency(e){return this.currencyPipe.transform(e,"Bs ","symbol","1.2-2")}}return u.\u0275fac=function(e){return new(e||u)(t.Y36(f.UZ),t.Y36(a.qu),t.Y36(n.s),t.Y36(c.uU),t.Y36(T.U),t.Y36(m.E),t.Y36(c.H9),t.Y36(g.M))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-productSales-detail"]],features:[t.qOj],decls:54,vars:18,consts:[["header",""],[1,"modal-title"],["body",""],[1,"form-material",3,"formGroup"],[1,"row"],[1,"col-md-3"],[3,"control"],["control","ventaId","bindLabel","idSales","label","Fecha de la Venta","value","id",3,"form","data","readonly","fetchItems","change"],[1,"col-md-5"],["control","productoId","bindLabel","product","label","Nombre del Producto","value","id",3,"form","data","readonly","fetchItems","change"],[1,"col-md-2"],["label","Precio Uni.",3,"control"],["type","text","formControlName","precioUni",1,"form-control"],["label","Cantidad",3,"control"],["formControlName","cantidad",1,"form-control",3,"searchable","clearable","change"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["value","6"],["value","7"],["value","8"],["value","9"],["value","10"],["value","11"],["value","12"],[1,"row","pt-3"],["label","Precio Total",3,"control"],["type","text","formControlName","precioTotal",1,"form-control"],["footer",""],[1,"d-flex","justify-content-center"],[1,"m-3"],[3,"type","disabled","confirm"],["type","button",1,"btn","btn-danger","active",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"app-modal")(1,"div",0)(2,"h5",1),t._uU(3),t.qZA()(),t.TgZ(4,"div",2)(5,"form",3)(6,"div",4)(7,"div",5)(8,"form-field",6)(9,"ngx-select",7),t.NdJ("fetchItems",function(l){return r.getSales(l)})("change",function(l){return r.onChangeReservations(l)}),t.qZA()()(),t.TgZ(10,"div",8)(11,"form-field",6)(12,"ngx-select",9),t.NdJ("fetchItems",function(l){return r.getProducts(l)})("change",function(l){return r.onChangeProducts(l)}),t.qZA()()(),t.TgZ(13,"div",10)(14,"form-field",11),t._UZ(15,"input",12),t.qZA()(),t.TgZ(16,"div",10)(17,"form-field",13)(18,"ng-select",14),t.NdJ("change",function(l){return r.onChangeAmount(l)}),t.TgZ(19,"ng-option",15),t._uU(20,"1 Uni."),t.qZA(),t.TgZ(21,"ng-option",16),t._uU(22,"2 Uni."),t.qZA(),t.TgZ(23,"ng-option",17),t._uU(24,"3 Uni."),t.qZA(),t.TgZ(25,"ng-option",18),t._uU(26,"4 Uni."),t.qZA(),t.TgZ(27,"ng-option",19),t._uU(28,"5 Uni."),t.qZA(),t.TgZ(29,"ng-option",20),t._uU(30,"6 Uni."),t.qZA(),t.TgZ(31,"ng-option",21),t._uU(32,"7 Uni."),t.qZA(),t.TgZ(33,"ng-option",22),t._uU(34,"8 Uni."),t.qZA(),t.TgZ(35,"ng-option",23),t._uU(36,"9 Uni."),t.qZA(),t.TgZ(37,"ng-option",24),t._uU(38,"10 Uni."),t.qZA(),t.TgZ(39,"ng-option",25),t._uU(40,"11 Uni."),t.qZA(),t.TgZ(41,"ng-option",26),t._uU(42,"12 Uni."),t.qZA()()()()(),t.TgZ(43,"div",27)(44,"div",5)(45,"form-field",28),t._UZ(46,"input",29),t.qZA()()()()(),t.TgZ(47,"div",30)(48,"div",31)(49,"div",32)(50,"confirm-button",33),t.NdJ("confirm",function(){return r.confirm()}),t.qZA()(),t.TgZ(51,"div",32)(52,"button",34),t.NdJ("click",function(){return r.close()}),t._uU(53," Cancelar "),t.qZA()()()()()),2&e&&(t.xp6(3),t.AsE("",r.edit?"Editar":"Nuevo"," ",r.title,""),t.xp6(2),t.Q6J("formGroup",r.form),t.xp6(3),t.Q6J("control",r.form.get("ventaId")),t.xp6(1),t.Q6J("form",r.form)("data",r.reservations)("readonly",!1),t.xp6(2),t.Q6J("control",r.form.get("productoId")),t.xp6(1),t.Q6J("form",r.form)("data",r.products)("readonly",!1),t.xp6(2),t.Q6J("control",r.form.get("precioUni")),t.xp6(3),t.Q6J("control",r.form.get("cantidad")),t.xp6(1),t.Q6J("searchable",!1)("clearable",!1),t.xp6(27),t.Q6J("control",r.form.get("precioTotal")),t.xp6(5),t.Q6J("type","button")("disabled",r.form.invalid))},dependencies:[a._Y,a.Fj,a.JJ,a.JL,S.w9,S.jq,I.z,b.h,y.f,a.sg,a.u,M.H]}),u})()},7209:(C,_,s)=>{s.d(_,{H:()=>O});var o=s(1571),a=s(4006),d=s(8796),p=s(7579),h=s(2722),t=s(8372),f=s(1884),n=s(3900),c=s(9646),m=s(168),g=s(4553),S=s(6895);function I(u,v){if(1&u&&(o.TgZ(0,"div",10),o._uU(1),o.qZA()),2&u){const e=v.item,r=o.oxw(3);o.Q6J("title",e[r.bindLabel]),o.xp6(1),o.Oqu(e[r.bindLabel])}}function b(u,v){1&u&&o.YNc(0,I,2,2,"ng-template",9)}function y(u,v){1&u&&(o.TgZ(0,"span"),o._uU(1,"*"),o.qZA()),2&u&&o.Udp("color","#9D2449")}function M(u,v){if(1&u){const e=o.EpF();o.ynx(0,1),o.TgZ(1,"div",2)(2,"ng-select",3,4),o.NdJ("scrollToEnd",function(){o.CHM(e);const i=o.MAs(3),l=o.oxw();return o.KtG(l.fetchMore(i.searchTerm))})("change",function(i){o.CHM(e);const l=o.oxw();return o.KtG(l.onChange(i))})("clear",function(){o.CHM(e);const i=o.oxw();return o.KtG(i.clear.emit())}),o.YNc(4,b,1,0,null,5),o.qZA(),o._UZ(5,"span",6),o.TgZ(6,"label",7),o._uU(7),o.YNc(8,y,2,2,"span",8),o.qZA()(),o.BQk()}if(2&u){const e=o.oxw();o.Q6J("formGroup",e.form),o.xp6(2),o.Q6J("clearable",e.clearable)("items",e.buffer)("bindLabel",e.bindLabel)("hideSelected",!0)("closeOnSelect",e.closeOnSelect)("maxSelectedItems",e.maxSelectedItems)("multiple",e.multiple)("bindValue",e.value)("minTermLength",0)("loading",e.loading)("addTag",e.addTag)("typeToSearchText",e.typeToSearchText)("typeahead",e.input$)("virtualScroll",!0)("formControlName",e.control)("searchable",e.searchable)("placeholder",e.placeholder)("readonly",e.readonly)("inputAttrs",e.inputAttrs)("title",e.title),o.uIk("class",e.className+" form-control"),o.xp6(2),o.Q6J("ngIf",e.showTooltip),o.xp6(3),o.hij("",e.label," "),o.xp6(1),o.Q6J("ngIf",e.isRequired())}}let O=(()=>{class u{constructor(e){this.fb=e,this.fetchByList=!0,this.control="",this.value="",this.bindLabel="",this.label="",this.placeholder="",this.data=new g.b,this.multiple=!1,this.addTag=!1,this.loading=!1,this.closeOnSelect=!0,this.maxSelectedItems=0,this.searchable=!0,this.searchOnInit=!1,this.typeToSearchText="Escriba 3 o m\xe1s caracteres",this.paramFilter="search",this.fetchItems=new o.vpe,this.fetchByParamsItems=new o.vpe,this.clear=new o.vpe,this.operator=m.ay.EQ,this.change=new o.vpe,this.readonly=!1,this.clearable=!0,this.showTooltip=!1,this.loadingInit=!1,this.className="",this.buffer=[],this.input$=new p.x,this.page=1,this.totalItems=0,this.inputAttrs={maxLength:""},this.title="",this.$unSubscribe=new p.x,this.concat=!1,this.selectSize=10}ngOnInit(){if(this.searchOnInit)if(this.fetchByList){this.loadingInit&&(this.loading=!0);const e=new m.NV;this.fetchItems.emit(e)}else{const e=new m.GQ;this.fetchByParamsItems.emit(e)}if(this.onSearch(),this.checkMaxAttribute(),this.showTooltip&&(this.updateTitle(),this.form&&this.control)){const e=this.form.get(this.control);e&&e.valueChanges.pipe((0,h.R)(this.$unSubscribe)).subscribe({next:r=>{null!=r&&this.updateTitle()},error:()=>{}})}}ngAfterViewInit(){this.labelTemplate&&this.ngSelect&&(this.ngSelect.labelTemplate=this.labelTemplate),this.optionTemplate&&this.ngSelect&&(this.ngSelect.optionTemplate=this.optionTemplate)}ngOnChanges(e){1==e.data?.currentValue?.reset&&(this.buffer=[],this.page=1),0===e.data?.currentValue?.length?this.buffer=[]:e.data&&this.concat?this.buffer=[...this.buffer,...this.data.data]:(this.buffer=this.data?.data,this.totalItems=this.data?.count),this.loading=!1}emitListParams(e){this.fetchItems.emit({page:this.page,text:e??"",limit:this.selectSize,search:e??""})}filterParams(e){let r=new m.GQ;r.page=this.page,r.limit=this.selectSize,"search"===this.paramFilter?r.search=e??"":e&&e.length>0&&r.addFilter(this.paramFilter,e,this.operator),this.fetchByParamsItems.emit(r)}fetchMore(e){!this.loading&&this.buffer.length<this.totalItems&&(this.page++,this.loading=!0,this.concat=!0,this.fetchByList?this.emitListParams(e):this.filterParams(e))}onSearch(){this.input$.pipe((0,t.b)(1e3),(0,f.x)(),(0,n.w)(e=>(null===e||(console.log(e),this.page=1,this.buffer=[],this.loading=!0,this.concat=!1,this.fetchByList?this.emitListParams(e):this.filterParams(e)),(0,c.of)([])))).subscribe()}onChange(e){this.change.emit(e),this.showTooltip&&e&&(e[this.bindLabel]?this.title=e[this.bindLabel]:e[this.value]&&(this.title=e[this.value]))}getLabel(e){return e[this.bindLabel]??""}isRequired(){if(this.form&&this.control){const e=this.form.get(this.control);if(e)return e.hasValidator(a.kI.required)}return!1}checkMaxAttribute(){null!=this.termMaxLength&&(this.inputAttrs.maxLength=this.termMaxLength)}updateTitle(){if(this.control&&this.form){const e=this.form.get(this.control);e&&("object"==typeof e.value&&null!=e.value?e.value[this.bindLabel]&&(this.title=e.value[this.bindLabel]):null!=e.value&&(this.title=e.value))}}ngOnDestroy(){this.$unSubscribe.next(),this.$unSubscribe.complete()}}return u.\u0275fac=function(e){return new(e||u)(o.Y36(a.qu))},u.\u0275cmp=o.Xpm({type:u,selectors:[["ngx-select"]],viewQuery:function(e,r){if(1&e&&o.Gf(d.w9,5),2&e){let i;o.iGM(i=o.CRH())&&(r.ngSelect=i.first)}},inputs:{form:"form",fetchByList:"fetchByList",control:"control",value:"value",bindLabel:"bindLabel",label:"label",placeholder:"placeholder",data:"data",multiple:"multiple",addTag:"addTag",loading:"loading",closeOnSelect:"closeOnSelect",maxSelectedItems:"maxSelectedItems",searchable:"searchable",searchOnInit:"searchOnInit",typeToSearchText:"typeToSearchText",paramFilter:"paramFilter",operator:"operator",readonly:"readonly",clearable:"clearable",termMaxLength:"termMaxLength",showTooltip:"showTooltip",labelTemplate:"labelTemplate",optionTemplate:"optionTemplate",loadingInit:"loadingInit",className:"className"},outputs:{fetchItems:"fetchItems",fetchByParamsItems:"fetchByParamsItems",clear:"clear",change:"change"},features:[o.TTD],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"form-group","form-secondary","form-static-label","pt-2"],["notFoundText","No se encontraron elementos",1,"form-control",3,"clearable","items","bindLabel","hideSelected","closeOnSelect","maxSelectedItems","multiple","bindValue","minTermLength","loading","addTag","typeToSearchText","typeahead","virtualScroll","formControlName","searchable","placeholder","readonly","inputAttrs","title","scrollToEnd","change","clear"],["select",""],[4,"ngIf"],[1,"form-bar"],[1,"float-label"],[3,"color",4,"ngIf"],["ng-option-tmp",""],[3,"title"]],template:function(e,r){1&e&&o.YNc(0,M,9,25,"ng-container",0),2&e&&o.Q6J("ngIf",r.form)},dependencies:[S.O5,a.JJ,a.JL,a.sg,a.u,d.w9,d.ir],styles:[".form-control[_ngcontent-%COMP%]{height:auto!important}"]}),u})()},9267:(C,_,s)=>{s.d(_,{j:()=>n});var o=s(4385),a=s(1571),d=s(6895),p=s(4006),h=s(4702);function t(c,T){if(1&c){const m=a.EpF();a.TgZ(0,"span",3)(1,"i",4),a.NdJ("click",function(S){a.CHM(m);const I=a.oxw();return a.KtG(I.clearDate(S))}),a.qZA()()}}const f=function(){return{dateInputFormat:"DD/MM/YYYY"}};let n=(()=>{class c extends o.tS{onChange(m){this.query=m,this.setFilter()}ngOnChanges(){}clearDate(m){m.stopPropagation(),this.query="",this.setFilter()}}return c.\u0275fac=function(){let T;return function(g){return(T||(T=a.n5z(c)))(g||c)}}(),c.\u0275cmp=a.Xpm({type:c,selectors:[["ng-component"]],inputs:{someInput:"someInput"},features:[a.qOj,a.TTD],decls:3,vars:5,consts:[[1,"input-group",2,"margin-bottom","0px"],["type","text","bsDatepicker","",1,"form-control",2,"border-radius","5px","padding","8px","border","1px solid #ccc",3,"ngModel","bsConfig","placeholder","ngModelChange"],["class","input-group-addon",4,"ngIf"],[1,"input-group-addon"],[1,"fa","fa-trash","red-icon",2,"color","#9D2449",3,"click"]],template:function(m,g){1&m&&(a.TgZ(0,"div",0)(1,"input",1),a.NdJ("ngModelChange",function(I){return g.onChange(I)}),a.qZA(),a.YNc(2,t,2,0,"span",2),a.qZA()),2&m&&(a.xp6(1),a.Q6J("ngModel",g.query)("bsConfig",a.DdM(4,f))("placeholder",g.column.title),a.xp6(1),a.Q6J("ngIf",g.query))},dependencies:[d.O5,p.Fj,p.JJ,p.On,h.Np,h.Y5],encapsulation:2}),c})()}}]);