"use strict";(self.webpackChunkalojamiento_frontend=self.webpackChunkalojamiento_frontend||[]).push([[577],{2577:(j,g,o)=>{o.r(g),o.d(g,{UsersModule:()=>k});var h=o(6895),v=o(6646),p=o(4385),b=o(1135),m=o(2722),l=o(168),C=o(8268);const S={id:{title:"ID",sort:!1,width:"10%"},email:{title:"Email",sort:!1,width:"80%"}},Z={id:{title:"ID",sort:!1,width:"7%"},nombre:{title:"Nombre",sort:!1},paterno:{title:"Paterno",sort:!1},materno:{title:"Materno",sort:!1},ci:{title:"CI",sort:!1},ext:{title:"Extenci\xf3n",sort:!1},celular:{title:"Celular",sort:!1},alojamiento:{title:"Alojamiento",sort:!1,valuePrepareFunction:i=>i?.nombre,filterFunction:(i,n)=>"string"!=typeof n||i.nombre?.toUpperCase()>=n.toUpperCase()||""===n}};var d=o(4006),U=o(999),I=o(4553),e=o(1571),f=o(388),A=o(2118),T=o(312),w=o(4576),_=o(7597);const y=function(i,n,t){return{"input-icon-eye2":i,"input-icon-eye1":n,"input-icon-eye":t}};let E=(()=>{class i extends C.nh{constructor(t,s,r,a){super(),this.modalRef=t,this.fb=s,this.usersService=r,this.datePipe=a,this.form=new d.cw({}),this.title="USUARIO",this.status="Nuevo",this.edit=!1,this.maxDate=new Date,this.deleteClass=!0,this.showPassword=!1,this.accomodations=new I.b}ngOnInit(){this.prepareForm()}prepareForm(){this.form=this.fb.group({email:[null,[d.kI.required,d.kI.pattern(U.QI)]],password:[null,[d.kI.required,d.kI.pattern(U.Fv)]]}),null!=this.users&&(this.edit=!0,this.form.patchValue(this.users))}confirm(){this.edit?this.update():this.create()}create(){this.loading=!0,this.usersService.create(this.form.getRawValue()).subscribe({next:t=>{this.handleSuccess(),this.loading=!1},error:t=>{this.loading=!1,this.alert("error",this.title,`${t}`)}})}handleSuccess(){this.alert("success",this.title,(this.edit?"Actualizada":"Guardada")+" Correctamente"),this.loading=!1,this.modalRef.content.callback(!0),this.modalRef.hide()}update(){this.users&&(this.loading=!0,this.usersService.update(this.users.id,this.form.getRawValue()).subscribe({next:t=>{this.loading=!1,this.handleSuccess()},error:t=>{this.loading=!1,this.alert("error",this.title,`${t}`)}}))}close(){this.modalRef.hide()}clean(){this.form.reset()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.UZ),e.Y36(d.qu),e.Y36(A.f),e.Y36(h.uU))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-users-detail"]],features:[e.qOj],decls:21,vars:15,consts:[["header",""],[1,"modal-title"],["body",""],[1,"form-material",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-md-6"],["label","Email",3,"control"],["type","email","formControlName","email","autocomplete","nope",1,"form-control"],["label","Contrase\xf1a",3,"control"],["autocomplete","new-password","formControlName","password",1,"form-control",3,"type"],["id","togglePassword",3,"ngClass","click"],["footer",""],[1,"d-flex","justify-content-center"],[1,"m-3"],[3,"type","disabled","confirm"],["type","button",1,"btn","btn-danger","active",3,"click"]],template:function(t,s){if(1&t&&(e.TgZ(0,"app-modal")(1,"div",0)(2,"h5",1),e._uU(3),e.qZA()(),e.TgZ(4,"div",2)(5,"form",3),e.NdJ("ngSubmit",function(){return s.confirm()}),e.TgZ(6,"div",4)(7,"div",5)(8,"form-field",6),e._UZ(9,"input",7),e.qZA()(),e.TgZ(10,"div",5)(11,"form-field",8),e._UZ(12,"input",9),e.TgZ(13,"i",10),e.NdJ("click",function(){return s.showPassword=!s.showPassword}),e.qZA()()()()()(),e.TgZ(14,"div",11)(15,"div",12)(16,"div",13)(17,"confirm-button",14),e.NdJ("confirm",function(){return s.confirm()}),e.qZA()(),e.TgZ(18,"div",13)(19,"button",15),e.NdJ("click",function(){return s.close()}),e._uU(20," Cancelar "),e.qZA()()()()()),2&t){let r;e.xp6(3),e.AsE("",s.edit?"Editar":"Nuevo"," ",s.title,""),e.xp6(2),e.Q6J("formGroup",s.form),e.xp6(3),e.Q6J("control",s.form.get("email")),e.xp6(3),e.Q6J("control",s.form.get("password")),e.xp6(1),e.Q6J("type",s.showPassword?"text":"password"),e.xp6(1),e.Tol(s.showPassword?"fa fa-eye-slash":"fa fa-eye"),e.Q6J("ngClass",e.kEZ(11,y,null==(r=s.form.get("password"))?null:r.invalid,null==(r=s.form.get("password"))?null:r.valid,s.deleteClass)),e.xp6(4),e.Q6J("type","button")("disabled",s.form.invalid)}},dependencies:[h.mk,d._Y,d.Fj,d.JJ,d.JL,T.z,w.h,_.f,d.sg,d.u],styles:["#togglePassword[_ngcontent-%COMP%]{margin-left:-30px;cursor:pointer;font-size:15px}"]}),i})();var L=o(4534),J=o(7795),N=o(9219),x=o(2243),F=o(4554);function R(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.openModal1())}),e._uU(2," Nuevo "),e._UZ(3,"i",11),e.qZA()()}}function Q(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",18)(2,"div",1)(3,"h5",2),e._uU(4,"DETALLES ENCARGADO"),e.qZA()(),e.TgZ(5,"div",6),e._UZ(6,"div",7),e.TgZ(7,"div",8),e.YNc(8,R,4,0,"div",19),e.TgZ(9,"app-columns-select",12),e.NdJ("settingsChange",function(r){e.CHM(t);const a=e.oxw();return e.KtG(a.settings1=r)}),e.qZA()()(),e.TgZ(10,"div",6)(11,"div",13)(12,"div")(13,"div",14)(14,"ng2-smart-table",20),e.NdJ("edit",function(r){e.CHM(t);const a=e.oxw();return e.KtG(a.edit1(r.data))})("delete",function(r){e.CHM(t);const a=e.oxw();return e.KtG(a.showDeleteAlert1(r.data))}),e.qZA()(),e._UZ(15,"app-pagination",16),e.qZA()()()()()}if(2&i){const t=e.oxw();e.xp6(8),e.Q6J("ngIf",t.totalItems1<1),e.xp6(1),e.Q6J("settings",t.settings1)("leftList",!0),e.xp6(3),e.Tol(t.loading?"table-loading":""),e.xp6(2),e.Q6J("settings",t.settings1)("source",t.data1),e.xp6(1),e.Q6J("params",t.params1)("totalItems",t.totalItems1)}}const D=[{path:"",component:(()=>{class i extends C.nh{constructor(t,s,r){super(),this.modalService=t,this.usersService=s,this.inChargeService=r,this.data=new p.nC,this.data1=new p.nC,this.params=new b.X(new l.NV),this.params1=new b.X(new l.NV),this.columnFilters=[],this.columnFilters1=[],this.totalItems=0,this.totalItems1=0,this.settings1={...this.settings},this.charge=!1,this.idUser=0,this.settings={...this.settings,hideSubHeader:!1,actions:{columnTitle:"Acciones",edit:!1,delete:!0,add:!1,position:"right"},columns:{...S}},this.settings1={...this.settings,hideSubHeader:!0,actions:{columnTitle:"Acciones",edit:!0,delete:!0,add:!1,position:"right"},columns:{...Z}}}ngOnInit(){this.data.onChanged().pipe((0,m.R)(this.$unSubscribe)).subscribe(t=>{"filter"===t.action&&(t.filter.filters.map(r=>{let a="",c=l.ay.ILIKE;c="id"===(a=`filter.${r.field}`,r.field)?l.ay.EQ:l.ay.ILIKE,""!==r.search?this.columnFilters[a]=`${c}:${r.search}`:delete this.columnFilters[a]}),this.params=this.pageFilter(this.params),this.getAllUsers())}),this.params.pipe((0,m.R)(this.$unSubscribe)).subscribe(()=>this.getAllUsers())}rowsSelected(t){this.rowSelect=t.data,t&&(this.charge=!0,this.idUser=t.data.id,this.params1.getValue()["filter.userId"]=`${l.ay.EQ}:${this.rowSelect.id}`,this.data.onChanged().pipe((0,m.R)(this.$unSubscribe)).subscribe(s=>{"filter"===s.action&&(s.filter.filters.map(a=>{let c="",u=l.ay.ILIKE;switch(c=`filter.${a.field}`,a.field){case"id":case"celular":u=l.ay.EQ;break;case"alojamiento":u=l.ay.ILIKE,c=`filter.${a.field}.nombre`;break;case"user":u=l.ay.ILIKE,c=`filter.${a.field}.email`;break;default:u=l.ay.ILIKE}""!==a.search?this.columnFilters[c]=`${u}:${a.search}`:delete this.columnFilters[c]}),this.params=this.pageFilter(this.params),this.getAllInCharge())}),this.params.pipe((0,m.R)(this.$unSubscribe)).subscribe(()=>this.getAllInCharge()))}getAllUsers(){this.loading=!0;let t={...this.params.getValue(),...this.columnFilters};this.usersService.getAll(t).subscribe({next:s=>{console.log(s),this.data.load(s.data),this.data.refresh(),this.totalItems=s.count,this.loading=!1},error:s=>{this.loading=!1,this.data.load([])}})}getAllInCharge(){this.loading=!0;let t={...this.params1.getValue(),...this.columnFilters1};this.inChargeService.getAll(t).subscribe({next:s=>{console.log(s),this.data1.load(s.data),this.data1.refresh(),this.totalItems1=s.count,this.loading=!1},error:s=>{this.loading=!1,this.data1.load([])}})}edit(t){this.openModal(t)}edit1(t){this.openModal1(t)}openModal(t){this.modalService.show(E,{initialState:{users:t,callback:r=>{r&&this.getAllUsers()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}openModal1(t){this.modalService.show(L.v,{initialState:{user:this.idUser,inCharges:t,callback:a=>{a&&this.getAllInCharge()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}showDeleteAlert(t){this.alertQuestion("warning","Eliminar","\xbfDesea eliminar este registro?").then(s=>{s.isConfirmed&&this.delete(t.id)})}showDeleteAlert1(t){this.alertQuestion("warning","Eliminar","\xbfDesea eliminar este registro?").then(s=>{s.isConfirmed&&this.delete1(t.id)})}delete(t){this.usersService.remove(t).subscribe({next:()=>{this.alert("success","Ususario","Borrado Correctamente"),this.params.pipe((0,m.R)(this.$unSubscribe)).subscribe(()=>this.getAllUsers())},error:s=>{this.alert("error","No se logro Eliminar","Existe una relacion")}})}delete1(t){this.inChargeService.remove(t).subscribe({next:()=>{this.alert("success","ENCARGADO","Borrado Correctamente"),this.params.pipe((0,m.R)(this.$unSubscribe)).subscribe(()=>this.getAllInCharge())},error:s=>{this.alert("error","No se logro Eliminar","Existe una relacion")}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.tT),e.Y36(A.f),e.Y36(J.t))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-users-list"]],features:[e.qOj],decls:25,vars:10,consts:[[3,"header"],["header","",1,"ch-content"],[1,"title"],["body",""],[1,"mt-5"],[1,"col-md-5"],[1,"row"],[1,"col-md-8","mb-3"],[1,"col-md-4","text-end","d-flex","flex-row-reverse","mb-3"],[1,"mr-3"],["type","button","tooltip","Nuevo","containerclass","tooltip-style",1,"btn","btn-info","btn-sm","active","d-flex","justify-content-center","align-items-center","ml-3",3,"click"],[1,"bx","bx-plus","bx-sm","ml-2"],[3,"settings","leftList","settingsChange"],[1,"col-md-12"],[1,"table-responsive"],[3,"settings","source","edit","delete","userRowSelect"],[3,"params","totalItems"],["class","mt-5",4,"ngIf"],[1,"col-md-7"],["class","mr-3",4,"ngIf"],[3,"settings","source","edit","delete"]],template:function(t,s){1&t&&(e.TgZ(0,"app-card",0)(1,"div",1)(2,"h5",2),e._uU(3,"ENCARGADOS"),e.qZA()(),e.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",1)(8,"h5",2),e._uU(9,"USUARIOS"),e.qZA()(),e.TgZ(10,"div",6),e._UZ(11,"div",7),e.TgZ(12,"div",8)(13,"div",9)(14,"button",10),e.NdJ("click",function(){return s.openModal()}),e._uU(15," Nuevo "),e._UZ(16,"i",11),e.qZA()(),e.TgZ(17,"app-columns-select",12),e.NdJ("settingsChange",function(a){return s.settings=a}),e.qZA()()(),e.TgZ(18,"div",6)(19,"div",13)(20,"div")(21,"div",14)(22,"ng2-smart-table",15),e.NdJ("edit",function(a){return s.edit(a.data)})("delete",function(a){return s.showDeleteAlert(a.data)})("userRowSelect",function(a){return s.rowsSelected(a)}),e.qZA()(),e._UZ(23,"app-pagination",16),e.qZA()()()()(),e.YNc(24,Q,16,9,"div",17),e.qZA()()),2&t&&(e.Q6J("header",!0),e.xp6(17),e.Q6J("settings",s.settings)("leftList",!0),e.xp6(3),e.Tol(s.loading?"table-loading":""),e.xp6(2),e.Q6J("settings",s.settings)("source",s.data),e.xp6(1),e.Q6J("params",s.params)("totalItems",s.totalItems),e.xp6(1),e.Q6J("ngIf",s.charge))},dependencies:[h.O5,N.A,x.L,p.T5,F.Q]}),i})()}];let M=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[v.Bz.forChild(D),v.Bz]}),i})();var $=o(8909);let k=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,M,$.m8,f.zk.forChild()]}),i})()}}]);