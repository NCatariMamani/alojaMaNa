"use strict";(self.webpackChunkalojamiento_frontend=self.webpackChunkalojamiento_frontend||[]).push([[781],{6913:(D,I,i)=>{i.d(I,{A:()=>R});var n=i(5551),r=i(8463),v=i(1571),A=i(4833);let R=(()=>{class T extends r.O{constructor(m){super(),this.accomodationRepo=m,this.router=n.J.Alojamientos}getAll(m){return this.accomodationRepo.getAll(this.router,m)}getById(m){return this.accomodationRepo.getById(this.router,m)}create(m){return this.accomodationRepo.create(this.router,m)}update(m,g){return this.accomodationRepo.updateTypeServices(this.router,m,g)}remove(m){return this.accomodationRepo.remove(this.router,m)}}return T.\u0275fac=function(m){return new(m||T)(v.LFG(A._))},T.\u0275prov=v.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},999:(D,I,i)=>{i.d(I,{Fv:()=>f,K2:()=>h,QI:()=>n,bu:()=>v});const n="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}$",v="^-?[0-9]+$",h="[+]?([0-9]*[.])?[0-9]+",f='(?![\\s])[a-zA-Z0-9\xe1\xe8\xe9\xed\xf3\xfa\xc1\xc8\xc9\xcd\xd3\xda\xf1\xd1\\/\\s\\.,_\\-\\\\()$\xb0\\\xdc\xfc\u201c\u201d"";:%]*'},1429:(D,I,i)=>{i.r(I),i.d(I,{ShoppingModule:()=>U});var n=i(6895),r=i(6646),v=i(8268),A=i(4385),R=i(1135),T=i(2722),S=i(168);const g={id:{title:"ID",sort:!1,width:"10%"},alojamientos:{title:"Nombre de Alojamiento",sort:!1,valuePrepareFunction:a=>a?.nombre,filterFunction:(a,u)=>"string"!=typeof u||a.nombre?.toUpperCase()>=u.toUpperCase()||""===u},fecha:{title:"Fecha",sort:!1,valuePrepareFunction:a=>{var u=new Date(a);return new n.uU("en-EN").transform(u,"dd/MM/yyyy","UTC")},filter:{type:"custom",component:i(9267).j}}};var h=i(4006),f=i(999),b=i(4553),e=i(1571),_=i(388),L=i(6913),P=i(5551),x=i(8463),O=i(4833);let d=(()=>{class a extends x.O{constructor(o){super(),this.shoppingRepo=o,this.router=P.J.Compras}getAll(o){return this.shoppingRepo.getAll(this.router,o)}getById(o){return this.shoppingRepo.getById(this.router,o)}create(o){return this.shoppingRepo.create(this.router,o)}update(o,s){return this.shoppingRepo.updateTypeServices(this.router,o,s)}remove(o){return this.shoppingRepo.remove(this.router,o)}}return a.\u0275fac=function(o){return new(o||a)(e.LFG(O._))},a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var E=i(4702),t=i(312),c=i(4576),C=i(7597),N=i(7209);const J=function(){return{dateInputFormat:"DD/MM/YYYY",displayOneMonthRange:!0}};let $=(()=>{class a extends v.nh{constructor(o,s,l,p,M){super(),this.modalRef=o,this.fb=s,this.accomodationService=l,this.shoppingService=p,this.datePipe=M,this.form=new h.cw({}),this.title="COMPRAS",this.status="Nuevo",this.edit=!1,this.maxDate=new Date,this.accomodations=new b.b}ngOnInit(){this.prepareForm()}prepareForm(){if(this.form=this.fb.group({fecha:[null,[h.kI.required,h.kI.pattern(f.Fv)]],alojamientoId:[null,[h.kI.required,h.kI.pattern(f.bu)]]}),null!=this.shopping){this.edit=!0;const o=this.datePipe.transform(this.shopping.fecha,"dd/MM/yyyy");console.log(o),this.form.patchValue(this.shopping),this.form.controls.fecha.setValue(o)}setTimeout(()=>{this.getAccomodation(new S.NV)},1e3)}confirm(){this.edit?this.update():this.create()}create(){this.loading=!0;let o={fecha:this.form.controls.fecha.getRawValue(),alojamientoId:Number(this.form.controls.alojamientoId.getRawValue())};this.shoppingService.create(o).subscribe({next:s=>{this.handleSuccess(),this.loading=!1},error:s=>{this.loading=!1}})}handleSuccess(){this.alert("success",this.title,(this.edit?"Actualizada":"Guardada")+" Correctamente"),this.loading=!1,this.modalRef.content.callback(!0),this.modalRef.hide()}update(){if(this.shopping){this.loading=!0;let s={fecha:this.editDate,alojamientoId:Number(this.form.controls.alojamientoId.getRawValue())};this.shoppingService.update(this.shopping.id,s).subscribe({next:l=>{this.loading=!1,this.handleSuccess()},error:l=>{this.loading=!1}})}}close(){this.modalRef.hide()}getAccomodation(o){o.text&&(o["filter.nombre"]=`$ilike:${o.text}`),this.accomodationService.getAll(o).subscribe({next:s=>{this.accomodations=new b.b(s.data,s.count)},error:s=>{this.accomodations=new b.b,this.loading=!1}})}onChangeAccomodation(o){console.log(o)}validateDate(o){o&&(this.editDate=o)}}return a.\u0275fac=function(o){return new(o||a)(e.Y36(_.UZ),e.Y36(h.qu),e.Y36(L.A),e.Y36(d),e.Y36(n.uU))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-shopping-detail"]],features:[e.qOj],decls:20,vars:13,consts:[["header",""],[1,"modal-title"],["body",""],[1,"form-material",3,"formGroup"],[1,"row"],[1,"col-md-6"],[3,"control"],["control","alojamientoId","bindLabel","nombre","label","Nombre del Alojamiento","value","id",3,"form","data","readonly","fetchItems","change"],["label","Fecha",3,"control"],["type","text","formControlName","fecha","bsDatepicker","",1,"form-control",3,"bsConfig","maxDate","bsValueChange"],["footer",""],[1,"d-flex","justify-content-center"],[1,"m-3"],[3,"type","disabled","confirm"],["type","button",1,"btn","btn-danger","active",3,"click"]],template:function(o,s){1&o&&(e.TgZ(0,"app-modal")(1,"div",0)(2,"h5",1),e._uU(3),e.qZA()(),e.TgZ(4,"div",2)(5,"form",3)(6,"div",4)(7,"div",5)(8,"form-field",6)(9,"ngx-select",7),e.NdJ("fetchItems",function(p){return s.getAccomodation(p)})("change",function(p){return s.onChangeAccomodation(p)}),e.qZA()()(),e.TgZ(10,"div",5)(11,"form-field",8)(12,"input",9),e.NdJ("bsValueChange",function(p){return s.validateDate(p)}),e.qZA()()()()()(),e.TgZ(13,"div",10)(14,"div",11)(15,"div",12)(16,"confirm-button",13),e.NdJ("confirm",function(){return s.confirm()}),e.qZA()(),e.TgZ(17,"div",12)(18,"button",14),e.NdJ("click",function(){return s.close()}),e._uU(19," Cancelar "),e.qZA()()()()()),2&o&&(e.xp6(3),e.AsE("",s.edit?"Editar":"Nuevo"," ",s.title,""),e.xp6(2),e.Q6J("formGroup",s.form),e.xp6(3),e.Q6J("control",s.form.get("alojamientoId")),e.xp6(1),e.Q6J("form",s.form)("data",s.accomodations)("readonly",!1),e.xp6(2),e.Q6J("control",s.form.get("fecha")),e.xp6(1),e.Q6J("bsConfig",e.DdM(12,J))("maxDate",s.maxDate),e.xp6(4),e.Q6J("type","button")("disabled",s.form.invalid))},dependencies:[E.Np,E.Y5,h._Y,h.Fj,h.JJ,h.JL,t.z,c.h,C.f,h.sg,h.u,N.H]}),a})();var z=i(9219),j=i(2243),F=i(4554);const y=[{path:"",component:(()=>{class a extends v.nh{constructor(o,s,l){super(),this.modalService=o,this.accomodationService=s,this.shoppingService=l,this.data=new A.nC,this.params=new R.X(new S.NV),this.data1=[],this.columnFilters=[],this.totalItems=0,this.settings={...this.settings,hideSubHeader:!1,actions:{columnTitle:"Acciones",edit:!0,delete:!0,add:!1,position:"right"},columns:{...g}}}ngOnInit(){this.data.onChanged().pipe((0,T.R)(this.$unSubscribe)).subscribe(o=>{"filter"===o.action&&(o.filter.filters.map(l=>{let p="",M=S.ay.ILIKE;switch(p=`filter.${l.field}`,l.field){case"id":M=S.ay.EQ;break;case"fecha":l.search=this.returnParseDate(l.search),M=S.ay.EQ;break;case"alojamientos":M=S.ay.ILIKE,p=`filter.${l.field}.nombre`;break;default:M=S.ay.ILIKE}""!==l.search?this.columnFilters[p]=`${M}:${l.search}`:delete this.columnFilters[p]}),this.params=this.pageFilter(this.params),this.getAllShopping())}),this.params.pipe((0,T.R)(this.$unSubscribe)).subscribe(()=>this.getAllShopping())}getAllShopping(){this.loading=!0;let o={...this.params.getValue(),...this.columnFilters};this.shoppingService.getAll(o).subscribe({next:s=>{console.log(s),this.data.load(s.data),this.data.refresh(),this.totalItems=s.count,this.loading=!1},error:s=>{this.loading=!1,this.data.load([])}})}edit(o){this.openModal(o)}openModal(o){this.modalService.show($,{initialState:{shopping:o,callback:l=>{l&&this.getAllShopping()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}showDeleteAlert(o){this.alertQuestion("warning","Eliminar","\xbfDesea eliminar este registro?").then(s=>{s.isConfirmed&&this.delete(o.id)})}delete(o){this.shoppingService.remove(o).subscribe({next:()=>{this.alert("success","Compras","Borrado Correctamente"),this.params.pipe((0,T.R)(this.$unSubscribe)).subscribe(()=>this.getAllShopping())},error:s=>{this.alert("error","No se logro Eliminar","Existe una relacion")}})}}return a.\u0275fac=function(o){return new(o||a)(e.Y36(_.tT),e.Y36(L.A),e.Y36(d))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-shopping-list"]],features:[e.qOj],decls:19,vars:9,consts:[[3,"header"],["header","",1,"ch-content"],[1,"title"],["body",""],[1,"row"],[1,"col-md-8","mb-3"],[1,"col-md-4","text-end","d-flex","flex-row-reverse","mb-3"],[1,"mr-3"],["type","button","tooltip","Nuevo","containerclass","tooltip-style",1,"btn","btn-info","btn-sm","active","d-flex","justify-content-center","align-items-center","ml-3",3,"click"],[1,"bx","bx-plus","bx-sm","ml-2"],[3,"settings","leftList","settingsChange"],[1,"col-md-12"],[1,"table-responsive"],[3,"settings","source","edit","delete"],[3,"params","totalItems"]],template:function(o,s){1&o&&(e.TgZ(0,"app-card",0)(1,"div",1)(2,"h5",2),e._uU(3,"COMPRAS"),e.qZA()(),e.TgZ(4,"div",3)(5,"div",4),e._UZ(6,"div",5),e.TgZ(7,"div",6)(8,"div",7)(9,"button",8),e.NdJ("click",function(){return s.openModal()}),e._uU(10," Nuevo "),e._UZ(11,"i",9),e.qZA()(),e.TgZ(12,"app-columns-select",10),e.NdJ("settingsChange",function(p){return s.settings=p}),e.qZA()()(),e.TgZ(13,"div",4)(14,"div",11)(15,"div")(16,"div",12)(17,"ng2-smart-table",13),e.NdJ("edit",function(p){return s.edit(p.data)})("delete",function(p){return s.showDeleteAlert(p.data)}),e.qZA()(),e._UZ(18,"app-pagination",14),e.qZA()()()()()),2&o&&(e.Q6J("header",!0),e.xp6(12),e.Q6J("settings",s.settings)("leftList",!0),e.xp6(3),e.Tol(s.loading?"table-loading":""),e.xp6(2),e.Q6J("settings",s.settings)("source",s.data),e.xp6(1),e.Q6J("params",s.params)("totalItems",s.totalItems))},dependencies:[z.A,j.L,A.T5,F.Q]}),a})()}];let B=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[r.Bz.forChild(y),r.Bz]}),a})();var Z=i(8909);let U=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[n.ez,B,Z.m8,_.zk.forChild()]}),a})()},7209:(D,I,i)=>{i.d(I,{H:()=>O});var n=i(1571),r=i(4006),v=i(8796),A=i(7579),R=i(2722),T=i(8372),S=i(1884),m=i(3900),g=i(9646),f=i(168),b=i(4553),e=i(6895);function _(d,E){if(1&d&&(n.TgZ(0,"div",10),n._uU(1),n.qZA()),2&d){const t=E.item,c=n.oxw(3);n.Q6J("title",t[c.bindLabel]),n.xp6(1),n.Oqu(t[c.bindLabel])}}function L(d,E){1&d&&n.YNc(0,_,2,2,"ng-template",9)}function P(d,E){1&d&&(n.TgZ(0,"span"),n._uU(1,"*"),n.qZA()),2&d&&n.Udp("color","#9D2449")}function x(d,E){if(1&d){const t=n.EpF();n.ynx(0,1),n.TgZ(1,"div",2)(2,"ng-select",3,4),n.NdJ("scrollToEnd",function(){n.CHM(t);const C=n.MAs(3),N=n.oxw();return n.KtG(N.fetchMore(C.searchTerm))})("change",function(C){n.CHM(t);const N=n.oxw();return n.KtG(N.onChange(C))})("clear",function(){n.CHM(t);const C=n.oxw();return n.KtG(C.clear.emit())}),n.YNc(4,L,1,0,null,5),n.qZA(),n._UZ(5,"span",6),n.TgZ(6,"label",7),n._uU(7),n.YNc(8,P,2,2,"span",8),n.qZA()(),n.BQk()}if(2&d){const t=n.oxw();n.Q6J("formGroup",t.form),n.xp6(2),n.Q6J("clearable",t.clearable)("items",t.buffer)("bindLabel",t.bindLabel)("hideSelected",!0)("closeOnSelect",t.closeOnSelect)("maxSelectedItems",t.maxSelectedItems)("multiple",t.multiple)("bindValue",t.value)("minTermLength",0)("loading",t.loading)("addTag",t.addTag)("typeToSearchText",t.typeToSearchText)("typeahead",t.input$)("virtualScroll",!0)("formControlName",t.control)("searchable",t.searchable)("placeholder",t.placeholder)("readonly",t.readonly)("inputAttrs",t.inputAttrs)("title",t.title),n.uIk("class",t.className+" form-control"),n.xp6(2),n.Q6J("ngIf",t.showTooltip),n.xp6(3),n.hij("",t.label," "),n.xp6(1),n.Q6J("ngIf",t.isRequired())}}let O=(()=>{class d{constructor(t){this.fb=t,this.fetchByList=!0,this.control="",this.value="",this.bindLabel="",this.label="",this.placeholder="",this.data=new b.b,this.multiple=!1,this.addTag=!1,this.loading=!1,this.closeOnSelect=!0,this.maxSelectedItems=0,this.searchable=!0,this.searchOnInit=!1,this.typeToSearchText="Escriba 3 o m\xe1s caracteres",this.paramFilter="search",this.fetchItems=new n.vpe,this.fetchByParamsItems=new n.vpe,this.clear=new n.vpe,this.operator=f.ay.EQ,this.change=new n.vpe,this.readonly=!1,this.clearable=!0,this.showTooltip=!1,this.loadingInit=!1,this.className="",this.buffer=[],this.input$=new A.x,this.page=1,this.totalItems=0,this.inputAttrs={maxLength:""},this.title="",this.$unSubscribe=new A.x,this.concat=!1,this.selectSize=10}ngOnInit(){if(this.searchOnInit)if(this.fetchByList){this.loadingInit&&(this.loading=!0);const t=new f.NV;this.fetchItems.emit(t)}else{const t=new f.GQ;this.fetchByParamsItems.emit(t)}if(this.onSearch(),this.checkMaxAttribute(),this.showTooltip&&(this.updateTitle(),this.form&&this.control)){const t=this.form.get(this.control);t&&t.valueChanges.pipe((0,R.R)(this.$unSubscribe)).subscribe({next:c=>{null!=c&&this.updateTitle()},error:()=>{}})}}ngAfterViewInit(){this.labelTemplate&&this.ngSelect&&(this.ngSelect.labelTemplate=this.labelTemplate),this.optionTemplate&&this.ngSelect&&(this.ngSelect.optionTemplate=this.optionTemplate)}ngOnChanges(t){1==t.data?.currentValue?.reset&&(this.buffer=[],this.page=1),0===t.data?.currentValue?.length?this.buffer=[]:t.data&&this.concat?this.buffer=[...this.buffer,...this.data.data]:(this.buffer=this.data?.data,this.totalItems=this.data?.count),this.loading=!1}emitListParams(t){this.fetchItems.emit({page:this.page,text:t??"",limit:this.selectSize,search:t??""})}filterParams(t){let c=new f.GQ;c.page=this.page,c.limit=this.selectSize,"search"===this.paramFilter?c.search=t??"":t&&t.length>0&&c.addFilter(this.paramFilter,t,this.operator),this.fetchByParamsItems.emit(c)}fetchMore(t){!this.loading&&this.buffer.length<this.totalItems&&(this.page++,this.loading=!0,this.concat=!0,this.fetchByList?this.emitListParams(t):this.filterParams(t))}onSearch(){this.input$.pipe((0,T.b)(1e3),(0,S.x)(),(0,m.w)(t=>(null===t||(console.log(t),this.page=1,this.buffer=[],this.loading=!0,this.concat=!1,this.fetchByList?this.emitListParams(t):this.filterParams(t)),(0,g.of)([])))).subscribe()}onChange(t){this.change.emit(t),this.showTooltip&&t&&(t[this.bindLabel]?this.title=t[this.bindLabel]:t[this.value]&&(this.title=t[this.value]))}getLabel(t){return t[this.bindLabel]??""}isRequired(){if(this.form&&this.control){const t=this.form.get(this.control);if(t)return t.hasValidator(r.kI.required)}return!1}checkMaxAttribute(){null!=this.termMaxLength&&(this.inputAttrs.maxLength=this.termMaxLength)}updateTitle(){if(this.control&&this.form){const t=this.form.get(this.control);t&&("object"==typeof t.value&&null!=t.value?t.value[this.bindLabel]&&(this.title=t.value[this.bindLabel]):null!=t.value&&(this.title=t.value))}}ngOnDestroy(){this.$unSubscribe.next(),this.$unSubscribe.complete()}}return d.\u0275fac=function(t){return new(t||d)(n.Y36(r.qu))},d.\u0275cmp=n.Xpm({type:d,selectors:[["ngx-select"]],viewQuery:function(t,c){if(1&t&&n.Gf(v.w9,5),2&t){let C;n.iGM(C=n.CRH())&&(c.ngSelect=C.first)}},inputs:{form:"form",fetchByList:"fetchByList",control:"control",value:"value",bindLabel:"bindLabel",label:"label",placeholder:"placeholder",data:"data",multiple:"multiple",addTag:"addTag",loading:"loading",closeOnSelect:"closeOnSelect",maxSelectedItems:"maxSelectedItems",searchable:"searchable",searchOnInit:"searchOnInit",typeToSearchText:"typeToSearchText",paramFilter:"paramFilter",operator:"operator",readonly:"readonly",clearable:"clearable",termMaxLength:"termMaxLength",showTooltip:"showTooltip",labelTemplate:"labelTemplate",optionTemplate:"optionTemplate",loadingInit:"loadingInit",className:"className"},outputs:{fetchItems:"fetchItems",fetchByParamsItems:"fetchByParamsItems",clear:"clear",change:"change"},features:[n.TTD],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"form-group","form-secondary","form-static-label","pt-2"],["notFoundText","No se encontraron elementos",1,"form-control",3,"clearable","items","bindLabel","hideSelected","closeOnSelect","maxSelectedItems","multiple","bindValue","minTermLength","loading","addTag","typeToSearchText","typeahead","virtualScroll","formControlName","searchable","placeholder","readonly","inputAttrs","title","scrollToEnd","change","clear"],["select",""],[4,"ngIf"],[1,"form-bar"],[1,"float-label"],[3,"color",4,"ngIf"],["ng-option-tmp",""],[3,"title"]],template:function(t,c){1&t&&n.YNc(0,x,9,25,"ng-container",0),2&t&&n.Q6J("ngIf",c.form)},dependencies:[e.O5,r.JJ,r.JL,r.sg,r.u,v.w9,v.ir],styles:[".form-control[_ngcontent-%COMP%]{height:auto!important}"]}),d})()},9267:(D,I,i)=>{i.d(I,{j:()=>m});var n=i(4385),r=i(1571),v=i(6895),A=i(4006),R=i(4702);function T(g,h){if(1&g){const f=r.EpF();r.TgZ(0,"span",3)(1,"i",4),r.NdJ("click",function(e){r.CHM(f);const _=r.oxw();return r.KtG(_.clearDate(e))}),r.qZA()()}}const S=function(){return{dateInputFormat:"DD/MM/YYYY"}};let m=(()=>{class g extends n.tS{onChange(f){this.query=f,this.setFilter()}ngOnChanges(){}clearDate(f){f.stopPropagation(),this.query="",this.setFilter()}}return g.\u0275fac=function(){let h;return function(b){return(h||(h=r.n5z(g)))(b||g)}}(),g.\u0275cmp=r.Xpm({type:g,selectors:[["ng-component"]],inputs:{someInput:"someInput"},features:[r.qOj,r.TTD],decls:3,vars:5,consts:[[1,"input-group",2,"margin-bottom","0px"],["type","text","bsDatepicker","",1,"form-control",2,"border-radius","5px","padding","8px","border","1px solid #ccc",3,"ngModel","bsConfig","placeholder","ngModelChange"],["class","input-group-addon",4,"ngIf"],[1,"input-group-addon"],[1,"fa","fa-trash","red-icon",2,"color","#9D2449",3,"click"]],template:function(f,b){1&f&&(r.TgZ(0,"div",0)(1,"input",1),r.NdJ("ngModelChange",function(_){return b.onChange(_)}),r.qZA(),r.YNc(2,T,2,0,"span",2),r.qZA()),2&f&&(r.xp6(1),r.Q6J("ngModel",b.query)("bsConfig",r.DdM(4,S))("placeholder",b.column.title),r.xp6(1),r.Q6J("ngIf",b.query))},dependencies:[v.O5,A.Fj,A.JJ,A.On,R.Np,R.Y5],encapsulation:2}),g})()}}]);