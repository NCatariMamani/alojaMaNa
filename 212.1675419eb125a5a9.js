"use strict";(self.webpackChunkalojamiento_frontend=self.webpackChunkalojamiento_frontend||[]).push([[212],{6913:(N,_,a)=>{a.d(_,{A:()=>S});var g=a(5551),T=a(8463),h=a(1571),u=a(4833);let S=(()=>{class c extends T.O{constructor(r){super(),this.accomodationRepo=r,this.router=g.J.Alojamientos}getAll(r){return this.accomodationRepo.getAll(this.router,r)}getById(r){return this.accomodationRepo.getById(this.router,r)}create(r){return this.accomodationRepo.create(this.router,r)}update(r,f){return this.accomodationRepo.updateTypeServices(this.router,r,f)}remove(r){return this.accomodationRepo.remove(this.router,r)}}return c.\u0275fac=function(r){return new(r||c)(h.LFG(u._))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},6698:(N,_,a)=>{a.d(_,{v:()=>S});var g=a(5551),T=a(8463),h=a(1571),u=a(4833);let S=(()=>{class c extends T.O{constructor(r){super(),this.customerRepo=r,this.router=g.J.Clientes}getAll(r){return this.customerRepo.getAll(this.router,r)}getById(r){return this.customerRepo.getById(this.router,r)}getAllAlojaClientesById(r,f){return this.customerRepo.getById02(`${this.router}/getByIdAlojaCli`,r,f)}getAllVentaClientesById(r,f){return this.customerRepo.getById02(`${this.router}/getVentaCliente`,r,f)}create(r){return this.customerRepo.create(this.router,r)}update(r,f){return this.customerRepo.updateTypeServices(this.router,r,f)}remove(r){return this.customerRepo.remove(this.router,r)}}return c.\u0275fac=function(r){return new(r||c)(h.LFG(u._))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},999:(N,_,a)=>{a.d(_,{Fv:()=>m,K2:()=>y,QI:()=>g,bu:()=>h});const g="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}$",h="^-?[0-9]+$",y="[+]?([0-9]*[.])?[0-9]+",m='(?![\\s])[a-zA-Z0-9\xe1\xe8\xe9\xed\xf3\xfa\xc1\xc8\xc9\xcd\xd3\xda\xf1\xd1\\/\\s\\.,_\\-\\\\()$\xb0\\\xdc\xfc\u201c\u201d"";:%]*'},8212:(N,_,a)=>{a.d(_,{f:()=>A});var g=a(4385),T=a(1135),h=a(2722),u=a(168),S=a(8268),c=a(6895),E=a(9267);const r={id:{title:"ID",sort:!1,width:"10%"},reservaciones:{title:"Nombre de la Reservaci\xf3n",sort:!1},fecha:{title:"Fecha",sort:!1,valuePrepareFunction:n=>{var d=new Date(n);return new c.uU("en-EN").transform(d,"dd/MM/yyyy","UTC")},filter:{type:"custom",component:E.j}}},f={id:{title:"ID",sort:!1,width:"10%"},ventas:{title:"Fecha de Reservaci\xf3n",sort:!1,valuePrepareFunction:n=>{var d=new Date(n?.fecha);return new c.uU("en-EN").transform(d,"dd/MM/yyyy","UTC")},filter:{type:"custom",component:E.j},width:"15%"},productos:{title:"Productos",sort:!1,valuePrepareFunction:n=>`${n?.nombre}`,filterFunction:(n,d)=>"string"!=typeof d||n.nombre?.toUpperCase()>=d.toUpperCase()||""===d},precioUni:{title:"Precio Uni.",sort:!1},cantidad:{title:"Cantidad",sort:!1},precioTotal:{title:"Total",sort:!1}};var y=a(9671),m=a(4006),D=a(999),R=a(4553),e=a(1571),b=a(388),$=a(6913),B=a(8278),M=a(2903),P=a(4702),w=a(312),F=a(4576),V=a(7597),J=a(7209);const Y=function(){return{dateInputFormat:"DD/MM/YYYY",displayOneMonthRange:!0}};let z=(()=>{class n extends S.nh{constructor(t,s,o,i,l,p){super(),this.modalRef=t,this.fb=s,this.accomodationService=o,this.reservationsService=i,this.salesService=l,this.datePipe=p,this.form=new m.cw({}),this.title="VENTA",this.status="Nuevo",this.edit=!1,this.maxDate=new Date,this.idReser=0,this.accomodations=new R.b}ngOnInit(){this.prepareForm()}prepareForm(){if(this.form=this.fb.group({fecha:[null,[m.kI.required,m.kI.pattern(D.Fv)]],reservacionId:[null,[m.kI.required,m.kI.pattern(D.bu)]]}),null!=this.sales&&(this.edit=!0,console.log(this.sales),this.form.patchValue(this.sales)),null!=this.reservations){this.idReser=this.reservations.id;const s=new Date(this.reservations.fecha),o=this.datePipe.transform(new Date(s.getTime()+6e4*s.getTimezoneOffset()),"dd/MM/yyyy");this.form.controls.fecha.setValue(o),this.form.controls.fecha.disable(),this.form.controls.reservacionId.setValue(this.idReser)}setTimeout(()=>{this.getReservation(new u.NV)},100)}confirm(){this.edit?this.update():this.create()}create(){this.loading=!0;const t=this.form.controls.fecha.getRawValue(),[s,o,i]=t.split("/").map(Number);let x={fecha:new Date(Date.UTC(i,o-1,s)).toISOString(),reservacionId:Number(this.form.controls.reservacionId.getRawValue())};this.salesService.create(x).subscribe({next:O=>{this.handleSuccess(),this.loading=!1},error:O=>{this.loading=!1}})}handleSuccess(){this.alert("success",this.title,(this.edit?"Actualizada":"Guardada")+" Correctamente"),this.loading=!1,this.modalRef.content.callback(!0),this.modalRef.hide()}update(){if(this.sales){this.loading=!0;const t=this.form.controls.fecha.getRawValue(),[s,o,i]=t.split("/").map(Number);let x={fecha:new Date(Date.UTC(i,o-1,s)).toISOString(),reservacionId:Number(this.form.controls.reservacionId.getRawValue())};this.salesService.update(this.sales.id,x).subscribe({next:O=>{this.loading=!1,this.handleSuccess()},error:O=>{this.loading=!1}})}}getReservation(t){(this.idReser||0!=this.idReser)&&(t["filter.id"]=`$eq:${this.idReser}`),this.reservationsService.getAll(t).subscribe({next:s=>{console.log(s),this.result=s.data.map(function(){var o=(0,y.Z)(function*(i){console.log(i.clientes);let l=i.clientes;i.name=l.nombre+" "+l.paterno+" "+l.materno});return function(i){return o.apply(this,arguments)}}()),this.accomodations=new R.b(s.data,s.count)},error:s=>{this.accomodations=new R.b,this.loading=!1}})}onChangeReservation(t){console.log(t)}close(){this.modalRef.hide()}validateDate(t){t&&(this.editDate=t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.UZ),e.Y36(m.qu),e.Y36($.A),e.Y36(B.E),e.Y36(M.M),e.Y36(c.uU))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-sales-detail"]],features:[e.qOj],decls:20,vars:13,consts:[["header",""],[1,"modal-title"],["body",""],[1,"form-material",3,"formGroup"],[1,"row"],[1,"col-md-6"],[3,"control"],["control","reservacionId","bindLabel","name","label","Reservaci\xf3n","value","id",3,"form","data","readonly","fetchItems","change"],["label","Fecha",3,"control"],["type","text","formControlName","fecha","bsDatepicker","",1,"form-control",3,"bsConfig","maxDate","bsValueChange"],["footer",""],[1,"d-flex","justify-content-center"],[1,"m-3"],[3,"type","disabled","confirm"],["type","button",1,"btn","btn-danger","active",3,"click"]],template:function(t,s){1&t&&(e.TgZ(0,"app-modal")(1,"div",0)(2,"h5",1),e._uU(3),e.qZA()(),e.TgZ(4,"div",2)(5,"form",3)(6,"div",4)(7,"div",5)(8,"form-field",6)(9,"ngx-select",7),e.NdJ("fetchItems",function(i){return s.getReservation(i)})("change",function(i){return s.onChangeReservation(i)}),e.qZA()()(),e.TgZ(10,"div",5)(11,"form-field",8)(12,"input",9),e.NdJ("bsValueChange",function(i){return s.validateDate(i)}),e.qZA()()()()()(),e.TgZ(13,"div",10)(14,"div",11)(15,"div",12)(16,"confirm-button",13),e.NdJ("confirm",function(){return s.confirm()}),e.qZA()(),e.TgZ(17,"div",12)(18,"button",14),e.NdJ("click",function(){return s.close()}),e._uU(19," Cancelar "),e.qZA()()()()()),2&t&&(e.xp6(3),e.AsE("",s.edit?"Editar":"Nuevo"," ",s.title,""),e.xp6(2),e.Q6J("formGroup",s.form),e.xp6(3),e.Q6J("control",s.form.get("reservacionId")),e.xp6(1),e.Q6J("form",s.form)("data",s.accomodations)("readonly",!1),e.xp6(2),e.Q6J("control",s.form.get("fecha")),e.xp6(1),e.Q6J("bsConfig",e.DdM(12,Y))("maxDate",s.maxDate),e.xp6(4),e.Q6J("type","button")("disabled",s.form.invalid))},dependencies:[P.Np,P.Y5,m._Y,m.Fj,m.JJ,m.JL,w.z,F.h,V.f,m.sg,m.u,J.H]}),n})();var Q=a(3947),G=a(2317),K=a(6698),L=a(9219),Z=a(2243),v=a(4554);function U(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"div",14)(1,"button",15),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.openModal())}),e._uU(2," Nuevo "),e._UZ(3,"i",16),e.qZA()()}}function I(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"div",17)(1,"div",8)(2,"div",1)(3,"h5",2),e._uU(4,"DETALLES DE VENTAS"),e.qZA()(),e.TgZ(5,"div",4)(6,"div",18)(7,"div",14)(8,"button",15),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.openModal1())}),e._uU(9," Nuevo "),e._UZ(10,"i",16),e.qZA()(),e.TgZ(11,"app-columns-select",19),e.NdJ("settingsChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.settings1=o)}),e.qZA()()(),e.TgZ(12,"div",4)(13,"div",8)(14,"div")(15,"div",9)(16,"ng2-smart-table",20),e.NdJ("edit",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.edit1(o.data))})("delete",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.showDeleteAlert1(o.data))}),e.qZA()(),e._UZ(17,"app-pagination",11),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(11),e.Q6J("settings",t.settings1)("leftList",!0),e.xp6(3),e.Tol(t.loading?"table-loading":""),e.xp6(2),e.Q6J("settings",t.settings1)("source",t.data1),e.xp6(1),e.Q6J("params",t.params1)("totalItems",t.totalItems1)}}function C(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"div",21)(1,"div",22)(2,"div",23)(3,"button",24),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.close())}),e._uU(4," Cancelar "),e.qZA()()()()}}let A=(()=>{class n extends S.nh{constructor(t,s,o,i,l,p){super(),this.modalService=t,this.salesService=s,this.modalRef=o,this.productSalesService=i,this.customersService=l,this.fb=p,this.form=new m.cw({}),this.data=new g.nC,this.data1=new g.nC,this.params=new T.X(new u.NV),this.params1=new T.X(new u.NV),this.columnFilters=[],this.columnFilters1=[],this.totalItems=0,this.totalItems1=0,this.validButton=!1,this.settings1={...this.settings},this.idSale=0,this.productSales=!1,this.settings={...this.settings,hideSubHeader:!0,actions:{columnTitle:"Acciones",edit:!0,delete:!0,add:!1,position:"right"},columns:{...r}},this.settings1={...this.settings,hideSubHeader:!0,actions:{columnTitle:"Acciones",edit:!0,delete:!0,add:!1,position:"right"},columns:{...f}}}ngOnInit(){this.data.onChanged().pipe((0,h.R)(this.$unSubscribe)).subscribe(t=>{"filter"===t.action&&(t.filter.filters.map(o=>{let i="",l=u.ay.ILIKE;switch(i=`filter.${o.field}`,o.field){case"id":l=u.ay.EQ;break;case"fecha":o.search=this.returnParseDate(o.search),l=u.ay.EQ;break;case"alojamientos":l=u.ay.ILIKE,i=`filter.${o.field}.nombre`;break;default:l=u.ay.ILIKE}""!==o.search?this.columnFilters[i]=`${l}:${o.search}`:delete this.columnFilters[i]}),this.params=this.pageFilter(this.params),this.getAllSales())}),this.params.pipe((0,h.R)(this.$unSubscribe)).subscribe(()=>this.getAllSales()),this.validButton=!!this.reservations,this.form=this.fb.group({productoId:[null,[m.kI.required]],ventaId:[null,[m.kI.required]]})}getAllSales(){this.loading=!0;let t={...this.params.getValue(),...this.columnFilters};this.reservations?this.salesService.getAllVentaClientesById(this.reservations.id,t).subscribe({next:s=>{console.log(s),this.data.load(s.data),this.data.refresh(),this.totalItems=s.count,this.loading=!1},error:s=>{this.loading=!1,this.data.load([])}}):this.loading=!1}edit(t){this.openModal(t)}openModal(t){this.modalService.show(z,{initialState:{sales:t,reservations:this.reservations,callback:i=>{i&&this.getAllSales()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}showDeleteAlert(t){this.alertQuestion("warning","Eliminar","\xbfDesea eliminar este registro?").then(s=>{s.isConfirmed&&this.delete(t.id)})}delete(t){this.salesService.remove(t).subscribe({next:()=>{this.alert("success","VENTA","Borrado Correctamente"),this.params.pipe((0,h.R)(this.$unSubscribe)).subscribe(()=>this.getAllSales())},error:s=>{this.alert("error","No se logro Eliminar","Existe una relacion")}})}close(){this.modalRef.hide()}rowsSelected(t){console.log(t),this.productSales=!0,this.idSale=t.id,this.data1.onChanged().pipe((0,h.R)(this.$unSubscribe)).subscribe(s=>{"filter"===s.action&&(s.filter.filters.map(i=>{let l="",p=u.ay.ILIKE;switch(l=`filter.${i.field}`,i.field){case"id":p=u.ay.EQ;break;case"fecha":i.search=this.returnParseDate(i.search),p=u.ay.EQ;break;case"alojamientos":p=u.ay.ILIKE,l=`filter.${i.field}.nombre`;break;default:p=u.ay.ILIKE}""!==i.search?this.columnFilters1[l]=`${p}:${i.search}`:delete this.columnFilters1[l]}),this.params1=this.pageFilter(this.params1),this.getAllProductSales())}),this.params1.pipe((0,h.R)(this.$unSubscribe)).subscribe(()=>this.getAllProductSales())}getAllProductSales(){this.loading=!0;let t={...this.params1.getValue(),...this.columnFilters1};t["filter.ventaId"]=`$eq:${this.idSale}`,this.productSalesService.getAll(t).subscribe({next:s=>{console.log(s),this.data1.load(s.data),this.data1.refresh(),this.totalItems1=s.count,this.loading=!1},error:s=>{this.loading=!1,this.data1.load([])}})}edit1(t){this.openModal1(t)}openModal1(t){this.modalService.show(Q.W,{initialState:{productSales:t,idSale:this.idSale,reservationsSales:this.reservations,callback:l=>{l&&this.getAllProductSales()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}showDeleteAlert1(t){this.alertQuestion("warning","Eliminar","\xbfDesea eliminar este registro?").then(s=>{s.isConfirmed&&this.delete(t.id)})}delete1(t){this.productSalesService.remove(t).subscribe({next:()=>{this.alert("success","PRODUCTO VENTA","Borrado Correctamente"),this.params.pipe((0,h.R)(this.$unSubscribe)).subscribe(()=>this.getAllProductSales())},error:s=>{this.alert("error","No se logro Eliminar","Existe una relacion")}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.tT),e.Y36(M.M),e.Y36(b.UZ),e.Y36(G.U),e.Y36(K.v),e.Y36(m.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-sales-list"]],features:[e.qOj],decls:17,vars:10,consts:[[3,"header"],["header","",1,"ch-content"],[1,"title"],["body",""],[1,"row"],[1,"col-md-8","mb-3"],[1,"col-md-4","text-end","d-flex","flex-row-reverse","mb-3"],["class","mr-3",4,"ngIf"],[1,"col-md-12"],[1,"table-responsive"],[3,"settings","source","edit","delete","userRowSelect"],[3,"params","totalItems"],["class","mt-5",4,"ngIf"],["footer","",4,"ngIf"],[1,"mr-3"],["type","button","tooltip","Nuevo","containerclass","tooltip-style",1,"btn","btn-info","btn-sm","active","d-flex","justify-content-center","align-items-center","ml-3",3,"click"],[1,"bx","bx-plus","bx-sm","ml-2"],[1,"mt-5"],[1,"col-md-12","text-end","d-flex","flex-row-reverse","mb-3"],[3,"settings","leftList","settingsChange"],[3,"settings","source","edit","delete"],["footer",""],[1,"d-flex","justify-content-center"],[1,"m-3"],["type","button",1,"btn","btn-danger","active",3,"click"]],template:function(t,s){1&t&&(e.TgZ(0,"app-card",0)(1,"div",1)(2,"h5",2),e._uU(3,"VENTAS"),e.qZA()(),e.TgZ(4,"div",3)(5,"div",4),e._UZ(6,"div",5),e.TgZ(7,"div",6),e.YNc(8,U,4,0,"div",7),e.qZA()(),e.TgZ(9,"div",4)(10,"div",8)(11,"div")(12,"div",9)(13,"ng2-smart-table",10),e.NdJ("edit",function(i){return s.edit(i.data)})("delete",function(i){return s.showDeleteAlert(i.data)})("userRowSelect",function(i){return s.rowsSelected(i.data)}),e.qZA()(),e._UZ(14,"app-pagination",11),e.qZA()()(),e.YNc(15,I,18,8,"div",12),e.qZA()(),e.YNc(16,C,5,0,"div",13)),2&t&&(e.Q6J("header",!0),e.xp6(8),e.Q6J("ngIf",s.totalItems<1),e.xp6(3),e.Tol(s.loading?"table-loading":""),e.xp6(2),e.Q6J("settings",s.settings)("source",s.data),e.xp6(1),e.Q6J("params",s.params)("totalItems",s.totalItems),e.xp6(1),e.Q6J("ngIf",s.productSales),e.xp6(1),e.Q6J("ngIf",s.validButton))},dependencies:[c.O5,L.A,Z.L,g.T5,v.Q]}),n})()}}]);