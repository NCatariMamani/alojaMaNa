"use strict";(self.webpackChunkalojamiento_frontend=self.webpackChunkalojamiento_frontend||[]).push([[467],{7795:(k,_,l)=>{l.d(_,{t:()=>Z});var h=l(5551),B=l(8463),p=l(1571),E=l(4833);let Z=(()=>{class v extends B.O{constructor(f){super(),this.usersRepo=f,this.router=h.J.Encargados}getAll(f){return this.usersRepo.getAll(this.router,f)}getById(f){return this.usersRepo.getById(this.router,f)}getAllHabUserById(f,N){return this.usersRepo.getById02(`${this.router}/getByEncargadoUser`,f,N)}create(f){return this.usersRepo.create(this.router,f)}update(f,N){return this.usersRepo.updateTypeServices(this.router,f,N)}remove(f){return this.usersRepo.remove(this.router,f)}}return v.\u0275fac=function(f){return new(f||v)(p.LFG(E._))},v.\u0275prov=p.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},1467:(k,_,l)=>{l.r(_),l.d(_,{ReservationsModule:()=>bt});var h=l(6895),B=l(6646),p=l(9671),E=l(4385),Z=l(1135),v=l(2722),g=l(168),f=l(8268);const z={habitaciones:{title:"No. Habitaci\xf3n",sort:!1,width:"6%",valuePrepareFunction:r=>`${r?.noHabitacion} ${r?.preferencias}`,filterFunction:(r,m)=>"string"!=typeof m||r.noHabitacion?.toUpperCase()>=m.toUpperCase()||""===m},clientes:{title:"Cliente",sort:!1,valuePrepareFunction:r=>`${r?.nombre} ${r?.paterno} ${r?.materno} ${r?.ci} ${r?.extencion}`,filterFunction:(r,m)=>"string"!=typeof m||`${r.nombre} ${r.paterno} ${r.materno} ${r?.ci} ${r?.extencion}`?.toUpperCase()>=m.toUpperCase()||""===m},horaEntrada:{title:"Hora Entrada",sort:!1},horaProgramada:{title:"Hora Programada",sort:!1},horaSalida:{title:"Hora Salida",sort:!1},tiempo:{title:"Tiempo",sort:!1},costoHabitacion:{title:"Costo Habitaci\xf3n",sort:!1},costoExtra:{title:"Costo Extra",sort:!1},total:{title:"Total",sort:!1},cambio:{title:"Cambio",sort:!1},estadoCambio:{title:"Estado de Cambio",sort:!1,type:"html",valuePrepareFunction:r=>"E"==r?'<strong><span class="badge badge-pill bg-disable-success">ENTREGADO</span></strong>':"P"==r?'<strong><span class="badge badge-pill badge-soft-pink">PENDIENTE</span></strong>':r,filter:{type:"list",config:{selectText:"Seleccionar",list:[{value:"E",title:"ENTREGADO"},{value:"P",title:"PENDIENTE"}]}}},encargados:{title:"Encargado",sort:!1,valuePrepareFunction:r=>`${r?.nombre} ${r?.paterno} ${r?.materno}`,filterFunction:(r,m)=>"string"!=typeof m||`${r.nombre} ${r.paterno} ${r.materno}`?.toUpperCase()>=m.toUpperCase()||""===m},id:{title:"ID",sort:!1,width:"10%"},fecha:{title:"Fecha",sort:!1,valuePrepareFunction:r=>{var m=new Date(r);return new h.uU("en-EN").transform(m,"dd/MM/yyyy","UTC")},filter:{type:"custom",component:l(9267).j}},compania:{title:"Compa\xf1ia",sort:!1}};var i=l(4006),A=l(999),I=l(4553),W=l(2510),t=l(1571),S=l(388),P=l(8278),J=l(6043),q=l(7795),Q=l(2059),X=l(6913),tt=l(6698),L=l(4702),V=l(8796),F=l(312),j=l(4576),Y=l(7597),et=l(7209);const ot=function(){return{dateInputFormat:"DD/MM/YYYY",displayOneMonthRange:!0}};let at=(()=>{class r extends f.nh{constructor(o,e,a,n,s,c,d,u,b,C,y){super(),this.modalRef=o,this.fb=e,this.datePipe=a,this.reservationsService=n,this.bedroomsService=s,this.inChargeService=c,this.authService=d,this.currencyPipe=u,this.accomodationService=b,this.customersService=C,this.modalService=y,this.form=new i.cw({}),this.title="RESERVACI\xd3N",this.status="Nuevo",this.edit=!1,this.infoInCharge=0,this.idAccom=0,this.maxDate=new Date,this.bedrooms=new I.b,this.inCharge=new I.b,this.accomodations=new I.b,this.customers=new I.b,this.couple=!1,this.form=this.fb.group({alojamientoId:[null,i.kI.required]})}get alojaId(){return this.form.get("alojamientoId")}get inChargeId(){return this.form.get("encargadoId")}get cliente(){return this.form.get("clienteId")}get habitaId(){return this.form.get("habitacionId")}ngOnInit(){this.getInCharges(),this.prepareForm()}prepareForm(){if(this.form=this.fb.group({fecha:[null,[i.kI.required]],horaEntrada:[null,[i.kI.required]],horaProgramada:[null,[i.kI.required]],tiempo:["MOMENTANEO",[i.kI.required]],compania:["OCUPADO",[i.kI.required]],costoHabitacion:[null,[i.kI.required,i.kI.pattern(A.K2)]],costoExtra:[null,[i.kI.pattern(A.K2)]],total:[null,[i.kI.required,i.kI.pattern(A.K2)]],montoEntregado:[null,[i.kI.required]],cambio:[null,[i.kI.required,i.kI.pattern(A.K2)]],estadoCambio:["P",[i.kI.required]],habitacionId:[null,[i.kI.required]],encargadoId:[null,[i.kI.required]],alojamientoId:[null,[i.kI.required]],clienteId:[null,[i.kI.required]]}),this.form.disable(),this.form.controls.habitacionId.enable(),this.form.controls.clienteId.enable(),null!=this.reservations){this.edit=!0;const o=new Date(this.reservations.fecha),e=this.datePipe.transform(new Date(o.getTime()+6e4*o.getTimezoneOffset()),"dd/MM/yyyy");this.form.patchValue(this.reservations),this.cliente.setValue(this.reservations.clienteId),this.habitaId.setValue(this.reservations.habitacionId),this.form.controls.fecha.setValue(e),this.form.controls.habitacionId.disable(),this.form.controls.encargadoId.disable(),this.form.controls.tiempo.disable(),this.form.controls.compania.disable(),console.log(this.reservations.habitacionId)}else{const o=new Date,e=this.datePipe.transform(o,"dd/MM/yyyy");this.form.controls.fecha.setValue(e),this.form.controls.horaEntrada.setValue(this.getCurrentFormattedTime()),this.canExecuteProcess()}setTimeout(()=>{this.getBedroom(new g.NV),this.getInCharge(new g.NV),this.getAccomodation(new g.NV),this.getCustomer(new g.NV)},100)}getInCharges(){var o=this;return(0,p.Z)(function*(){const e=o.authService.getUserInfo();o.infoInCharge=e.id,console.log(o.infoInCharge),o.inCharge1=yield o.validInCharge(e.id),o.idAccom=o.inCharge1[0].alojamientoId;const a=o.inCharge1[0].id;o.alojaId.setValue(o.idAccom),o.inChargeId.setValue(a),console.log(o.inCharge1)})()}validInCharge(o){var e=this;return(0,p.Z)(function*(){const a=new g.NV;return a["filter.userId"]=`$eq:${o}`,new Promise((n,s)=>{e.inChargeService.getAll(a).subscribe({next:c=>{n(c.data)},error:c=>{n(0)}})})})()}getCurrentFormattedTime(){const o=new Date;let e=o.getHours();const n=e>=12?"pm":"am";return e%=12,e=e||12,`${e}:${o.getMinutes().toString().padStart(2,"0")} ${n}`}canExecuteProcess(){const o=new Date;let e=o.getHours();const a=o.getMinutes();e>22||22===e&&a>=0||e>=0&&e<=5?(setTimeout(()=>{this.alert("info","A partir de las 10:00 PM solo se ofrecen habitaciones por toda la noche","")},500),this.form.controls.horaProgramada.setValue("12:00 pm"),this.form.controls.tiempo.setValue("TODA LA NOCHE"),this.form.controls.montoEntregado.enable(),this.form.controls.tiempo.disable()):(this.form.controls.horaProgramada.setValue(this.getTimeTwo()),console.log(this.getTimeTwo()),this.form.controls.tiempo.enable())}confirm(){this.edit?this.update():this.create()}formatToBolivianCurrency(o){return this.currencyPipe.transform(o,"Bs ","symbol","1.2-2")}create(){this.loading=!0;const o=this.form.controls.fecha.getRawValue(),[e,a,n]=o.split("/").map(Number);let d={fecha:new Date(Date.UTC(n,a-1,e)).toISOString(),horaEntrada:this.form.controls.horaEntrada.getRawValue(),horaProgramada:this.form.controls.horaProgramada.getRawValue(),tiempo:this.form.controls.tiempo.getRawValue(),compania:this.form.controls.compania.getRawValue(),montoEntregado:this.form.controls.montoEntregado.getRawValue(),cambio:this.form.controls.cambio.getRawValue(),estadoCambio:this.form.controls.estadoCambio.getRawValue(),costoHabitacion:this.form.controls.costoHabitacion.getRawValue(),total:this.form.controls.total.getRawValue(),clienteId:this.form.controls.clienteId.getRawValue(),habitacionId:Number(this.form.controls.habitacionId.getRawValue()),encargadoId:Number(this.form.controls.encargadoId.getRawValue()),alojamientoId:Number(this.form.controls.alojamientoId.getRawValue())},u={estado:"OCUPADO"};this.reservationsService.create(d).subscribe({next:b=>{this.bedroomsService.update(this.form.controls.habitacionId.getRawValue(),u).subscribe({next:C=>{this.handleSuccess(),this.loading=!1},error:C=>{this.loading=!1}})},error:b=>{this.loading=!1}})}handleSuccess(){this.alert("success",this.title,(this.edit?"Actualizada":"Guardada")+" Correctamente"),this.loading=!1,this.modalRef.content.callback(!0),this.modalRef.hide()}update(){if(this.reservations){this.loading=!0;const o=this.form.controls.fecha.getRawValue(),[e,a,n]=o.split("/").map(Number),c=new Date(Date.UTC(n,a-1,e)).toISOString();let d={compania:this.form.controls.compania.getRawValue(),fecha:c,horaEntrada:this.form.controls.horaEntrada.getRawValue(),horaProgramada:this.form.controls.horaProgramada.getRawValue(),tiempo:this.form.controls.tiempo.getRawValue(),montoEntregado:this.form.controls.montoEntregado.getRawValue(),cambio:this.form.controls.cambio.getRawValue(),estadoCambio:this.form.controls.estadoCambio.getRawValue(),costoHabitacion:this.form.controls.costoHabitacion.getRawValue(),total:this.form.controls.total.getRawValue(),habitacionId:Number(this.form.controls.habitacionId.getRawValue()),encargadoId:Number(this.form.controls.encargadoId.getRawValue()),alojamientoId:Number(this.form.controls.alojamientoId.getRawValue()),clienteId:this.form.controls.clienteId.getRawValue()};this.reservationsService.update(this.reservations.id,d).subscribe({next:u=>{this.loading=!1,this.handleSuccess()},error:u=>{this.loading=!1}})}}close(){this.modalRef.hide()}getBedroom(o){if(this.reservations||(o["filter.estado"]="$ilike:LIBRE"),o.text){const a=Number(o.text);isNaN(a)?o["filter.preferencias"]=`$ilike:${o.text}`:o["filter.noHabitacion"]=`$eq:${o.text}`}const e=this.authService.getUserInfo();this.infoInCharge=e.id,console.log(e.id),this.bedroomsService.getAllHabUserById(e.id,o).subscribe({next:a=>{this.result=a.data.map(function(){var n=(0,p.Z)(function*(s){s.noHabPref=s.noHabitacion+" - "+s.preferencias+" "+s.estado});return function(s){return n.apply(this,arguments)}}()),this.bedrooms=new I.b(a.data,a.count)},error:a=>{this.bedrooms=new I.b,this.loading=!1}})}onChangeBedroom(o){if(console.log(o),this.prefe=o,"SIMPLE"==o&&"MOMENTANEO"==this.form.controls.tiempo.value){const e=this.formatToBolivianCurrency(30);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e),this.form.controls.montoEntregado.enable(),this.form.controls.estadoCambio.enable()}else if("SIMPLE"==o&&"TODA LA NOCHE"==this.form.controls.tiempo.value){const e=this.formatToBolivianCurrency(60);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e),this.form.controls.montoEntregado.enable(),this.form.controls.estadoCambio.enable()}else if("BA\xd1O PRIVADO"==o&&"MOMENTANEO"==this.form.controls.tiempo.value){const e=this.formatToBolivianCurrency(40);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e),this.form.controls.montoEntregado.enable(),this.form.controls.estadoCambio.enable()}else{const e=this.formatToBolivianCurrency(70);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e),this.form.controls.montoEntregado.enable(),this.form.controls.estadoCambio.enable()}}validateDate(o){o&&(this.editDate=o)}getInCharge(o){this.inChargeService.getAllHabUserById(this.infoInCharge,o).subscribe({next:e=>{this.result2=e.data.map(function(){var a=(0,p.Z)(function*(n){n.idUser=n.id+" - "+n.nombre+" "+n.paterno+" "+n.materno});return function(n){return a.apply(this,arguments)}}()),this.inCharge=new I.b(e.data,e.count)},error:e=>{this.inCharge=new I.b,this.loading=!1}})}onChangeInCharge(o){o&&(this.idAccom=o.alojamientoId,this.form.controls.habitacionId.enable(),this.getBedroom(new g.NV),this.getCustomer(new g.NV))}onChangeCompanion(o){console.log(o),"CON PAREJA"==o?(this.couple=!0,this.form.controls.nombreA.enable(),this.form.controls.paternoA.enable(),this.form.controls.maternoA.enable(),this.form.controls.ciA.enable(),this.form.controls.extencionA.enable()):(this.couple=!1,this.form.controls.nombreA.disable(),this.form.controls.paternoA.disable(),this.form.controls.maternoA.disable(),this.form.controls.ciA.disable(),this.form.controls.extencionA.disable())}onChangeTime(o){if(console.log(o),"MOMENTANEO"==o?this.form.controls.horaProgramada.setValue(this.getTimeTwo()):"TODA LA NOCHE"==o&&this.form.controls.horaProgramada.setValue("12:00 pm"),"SIMPLE"==this.prefe&&"MOMENTANEO"==o){const e=this.formatToBolivianCurrency(30);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e)}else if("SIMPLE"==this.prefe&&"TODA LA NOCHE"==o){const e=this.formatToBolivianCurrency(60);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e)}else if("BA\xd1O PRIVADO"==this.prefe&&"MOMENTANEO"==o){const e=this.formatToBolivianCurrency(40);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e)}else{const e=this.formatToBolivianCurrency(70);this.form.controls.costoHabitacion.setValue(e),this.form.controls.total.setValue(e)}}getTimeTwo(){const o=this.addHoursToTime(2);console.log(o),o.setMinutes(o.getMinutes()+10);let e=o.getHours();console.log(e);const n=e>=12?"pm":"am";return e%=12,e=e||12,`${e}:${o.getMinutes().toString().padStart(2,"0")} ${n}`}addHoursToTime(o){const e=new Date;return e.setHours(e.getHours()+o),e}getAccomodation(o){var e=this;return(0,p.Z)(function*(){console.log(e.infoInCharge);let a=yield e.validInCharge(e.infoInCharge);a&&console.log(a),e.accomodationService.getAll(o).subscribe({next:n=>{e.accomodations=new I.b(n.data,n.count)},error:n=>{e.accomodations=new I.b,e.loading=!1}})})()}getCustomer(o){if(o.text){const e=Number(o.text);isNaN(e)?o["filter.nombre"]=`$ilike:${o.text}`:o["filter.ci"]=`$eq:${o.text}`}console.log(this.idAccom),this.customersService.getAllAlojaClientesById(this.idAccom,o).subscribe({next:e=>{this.result=e.data.map(function(){var a=(0,p.Z)(function*(n){n.idName=n.nombre+" "+n.paterno+" "+n.materno+" "+n.ci+" "+n.extencion});return function(n){return a.apply(this,arguments)}}()),this.customers=new I.b(e.data,e.count)},error:e=>{this.customers=new I.b,this.loading=!1}})}onChangeCustomer(o){console.log(o)}onChangeAccomodation(o){console.log(o)}onChangeState(o){if("E"==o){const e=this.formatToBolivianCurrency(0);this.form.controls.cambio.setValue(e)}else this.onChangeMoney(this.form.controls.montoEntregado.getRawValue())}onChangeMoney(o){const e=parseInt(o),a=parseInt(this.form.controls.total.value);if(console.log(e,a),e>a){const n=e-a;console.log(n);const s=this.formatToBolivianCurrency(n);this.form.controls.cambio.setValue(s),this.form.controls.estadoCambio.enable(),this.form.controls.estadoCambio.setValue("P")}else{if(e!==a)return this.alert("warning",`El monto ${o} debe ser mayor al total`,""),void this.form.controls.montoEntregado.setValue("");{const n=this.formatToBolivianCurrency(0);this.form.controls.cambio.setValue(n),this.form.controls.estadoCambio.disable(),this.form.controls.estadoCambio.setValue("E")}}}convertirMonedaACifra(o){return parseFloat(o.replace(" Bs","").replace(",","."))}openModal(){this.modalService.show(W.F,{initialState:{idAloja:this.idAccom,callback:a=>{a&&this.getCustomer(new g.NV)}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(S.UZ),t.Y36(i.qu),t.Y36(h.uU),t.Y36(P.E),t.Y36(J.c),t.Y36(q.t),t.Y36(Q.e),t.Y36(h.H9),t.Y36(X.A),t.Y36(tt.v),t.Y36(S.tT))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-reservations-detail"]],features:[t.qOj],decls:100,vars:43,consts:[["header",""],[1,"modal-title"],["body",""],[1,"form-material",3,"formGroup"],[1,"row","pt-4"],[1,"col-md-4"],[3,"control"],["control","alojamientoId","bindLabel","nombre","label","Nombre del Alojamiento","value","id",3,"form","data","readonly","fetchItems","change"],[1,"col-md-3"],["label","Compa\xf1ia",3,"control"],["formControlName","compania",1,"form-control",3,"searchable","clearable","change"],["value","SOLO"],["value","CON PAREJA"],[1,"col-md-5"],["control","encargadoId","bindLabel","idUser","label","Encargado","value","id",3,"form","data","readonly","fetchItems","change"],[1,"col-md-6"],["control","clienteId","bindLabel","idName","label","Cliente","value","id",3,"form","data","readonly","fetchItems","change"],[1,"col-md-2"],["type","button","tooltip","Nuevo","containerclass","tooltip-style",1,"btn","btn-info","btn-sm","active","d-flex","justify-content-center","align-items-center","ml-3",3,"click"],[1,"bx","bx-plus","bx-sm","ml-2"],["control","habitacionId","bindLabel","noHabPref","label","No. Habitaci\xf3n","value","id",3,"form","data","readonly","fetchItems","change"],["label","Fecha",3,"control"],["type","text","formControlName","fecha","bsDatepicker","",1,"form-control",3,"bsConfig","maxDate","bsValueChange"],["label","Hora Entrada",3,"control"],["type","text","formControlName","horaEntrada",1,"form-control"],["label","Tiempo",3,"control"],["formControlName","tiempo",1,"form-control",3,"searchable","clearable","change"],["value","MOMENTANEO"],["value","TODA LA NOCHE"],["label","Hora Programada",3,"control"],["type","text","formControlName","horaProgramada",1,"form-control"],["label","Costo Habitaci\xf3n",3,"control"],["type","text","formControlName","costoHabitacion",1,"form-control"],["label","Costo Extra",3,"control"],["type","text","formControlName","costoExtra",1,"form-control"],["label","Total",3,"control"],["type","text","formControlName","total",1,"form-control"],["label","Monto Entregado",3,"control"],["formControlName","montoEntregado",1,"form-control",3,"searchable","clearable","change"],["value","30,00 Bs"],["value","40,00 Bs"],["value","50,00 Bs"],["value","60,00 Bs"],["value","70,00 Bs"],["value","80,00 Bs"],["value","90,00 Bs"],["value","100,00 Bs"],["value","150,00 Bs"],["value","200,00 Bs"],["label","Cambio",3,"control"],["type","text","formControlName","cambio",1,"form-control"],["label","Estado Cambio",3,"control"],["formControlName","estadoCambio",1,"form-control",3,"searchable","clearable","change"],["value","P"],["value","E"],["footer",""],[1,"d-flex","justify-content-center"],[1,"m-3"],[3,"type","disabled","confirm"],["type","button",1,"btn","btn-danger","active",3,"click"]],template:function(o,e){1&o&&(t.TgZ(0,"app-modal")(1,"div",0)(2,"h5",1),t._uU(3),t.qZA()(),t.TgZ(4,"div",2)(5,"form",3)(6,"div",4)(7,"div",5)(8,"form-field",6)(9,"ngx-select",7),t.NdJ("fetchItems",function(n){return e.getAccomodation(n)})("change",function(n){return e.onChangeAccomodation(n)}),t.qZA()()(),t.TgZ(10,"div",8)(11,"form-field",9)(12,"ng-select",10),t.NdJ("change",function(n){return e.onChangeCompanion(n)}),t.TgZ(13,"ng-option",11),t._uU(14,"SOLO"),t.qZA(),t.TgZ(15,"ng-option",12),t._uU(16,"CON PAREJA"),t.qZA()()()(),t.TgZ(17,"div",13)(18,"form-field",6)(19,"ngx-select",14),t.NdJ("fetchItems",function(n){return e.getInCharge(n)})("change",function(n){return e.onChangeInCharge(n)}),t.qZA()()()(),t.TgZ(20,"div",4)(21,"div",15)(22,"form-field",6)(23,"ngx-select",16),t.NdJ("fetchItems",function(n){return e.getCustomer(n)})("change",function(n){return e.onChangeCustomer(n)}),t.qZA()()(),t.TgZ(24,"div",17)(25,"button",18),t.NdJ("click",function(){return e.openModal()}),t._uU(26," Cliente "),t._UZ(27,"i",19),t.qZA()(),t.TgZ(28,"div",5)(29,"form-field",6)(30,"ngx-select",20),t.NdJ("fetchItems",function(n){return e.getBedroom(n)})("change",function(n){return e.onChangeBedroom(n.preferencias)}),t.qZA()()()(),t.TgZ(31,"div",4)(32,"div",8)(33,"form-field",21)(34,"input",22),t.NdJ("bsValueChange",function(n){return e.validateDate(n)}),t.qZA()()(),t.TgZ(35,"div",8)(36,"form-field",23),t._UZ(37,"input",24),t.qZA()(),t.TgZ(38,"div",8)(39,"form-field",25)(40,"ng-select",26),t.NdJ("change",function(n){return e.onChangeTime(n)}),t.TgZ(41,"ng-option",27),t._uU(42,"MOMENTANEO"),t.qZA(),t.TgZ(43,"ng-option",28),t._uU(44,"TODA LA NOCHE"),t.qZA()()()(),t.TgZ(45,"div",8)(46,"form-field",29),t._UZ(47,"input",30),t.qZA()()(),t._UZ(48,"div",4),t.TgZ(49,"div",4)(50,"div",5)(51,"form-field",31),t._UZ(52,"input",32),t.qZA()(),t.TgZ(53,"div",5)(54,"form-field",33),t._UZ(55,"input",34),t.qZA()(),t.TgZ(56,"div",5)(57,"form-field",35),t._UZ(58,"input",36),t.qZA()()(),t.TgZ(59,"div",4)(60,"div",5)(61,"form-field",37)(62,"ng-select",38),t.NdJ("change",function(n){return e.onChangeMoney(n)}),t.TgZ(63,"ng-option",39),t._uU(64,"30,00 Bs"),t.qZA(),t.TgZ(65,"ng-option",40),t._uU(66,"40,00 Bs"),t.qZA(),t.TgZ(67,"ng-option",41),t._uU(68,"50,00 Bs"),t.qZA(),t.TgZ(69,"ng-option",42),t._uU(70,"60,00 Bs"),t.qZA(),t.TgZ(71,"ng-option",43),t._uU(72,"70,00 Bs"),t.qZA(),t.TgZ(73,"ng-option",44),t._uU(74,"80,00 Bs"),t.qZA(),t.TgZ(75,"ng-option",45),t._uU(76,"90,00 Bs"),t.qZA(),t.TgZ(77,"ng-option",46),t._uU(78,"100,00 Bs"),t.qZA(),t.TgZ(79,"ng-option",47),t._uU(80,"150,00 Bs"),t.qZA(),t.TgZ(81,"ng-option",48),t._uU(82,"200,00 Bs"),t.qZA()()()(),t.TgZ(83,"div",5)(84,"form-field",49),t._UZ(85,"input",50),t.qZA()(),t.TgZ(86,"div",5)(87,"form-field",51)(88,"ng-select",52),t.NdJ("change",function(n){return e.onChangeState(n)}),t.TgZ(89,"ng-option",53),t._uU(90,"PENDIENTE"),t.qZA(),t.TgZ(91,"ng-option",54),t._uU(92,"ENTREGADO"),t.qZA()()()()()()(),t.TgZ(93,"div",55)(94,"div",56)(95,"div",57)(96,"confirm-button",58),t.NdJ("confirm",function(){return e.confirm()}),t.qZA()(),t.TgZ(97,"div",57)(98,"button",59),t.NdJ("click",function(){return e.close()}),t._uU(99," Cancelar "),t.qZA()()()()()),2&o&&(t.xp6(3),t.AsE("",e.edit?"Editar":"Nuevo"," ",e.title,""),t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("control",e.form.get("alojamientoId")),t.xp6(1),t.Q6J("form",e.form)("data",e.accomodations)("readonly",!1),t.xp6(2),t.Q6J("control",e.form.get("compania")),t.xp6(1),t.Q6J("searchable",!1)("clearable",!1),t.xp6(6),t.Q6J("control",e.form.get("encargadoId")),t.xp6(1),t.Q6J("form",e.form)("data",e.inCharge)("readonly",!1),t.xp6(3),t.Q6J("control",e.form.get("clienteId")),t.xp6(1),t.Q6J("form",e.form)("data",e.customers)("readonly",!1),t.xp6(6),t.Q6J("control",e.form.get("habitacionId")),t.xp6(1),t.Q6J("form",e.form)("data",e.bedrooms)("readonly",!1),t.xp6(3),t.Q6J("control",e.form.get("fecha")),t.xp6(1),t.Q6J("bsConfig",t.DdM(42,ot))("maxDate",e.maxDate),t.xp6(2),t.Q6J("control",e.form.get("horaEntrada")),t.xp6(3),t.Q6J("control",e.form.get("tiempo")),t.xp6(1),t.Q6J("searchable",!1)("clearable",!1),t.xp6(6),t.Q6J("control",e.form.get("horaProgramada")),t.xp6(5),t.Q6J("control",e.form.get("costoHabitacion")),t.xp6(3),t.Q6J("control",e.form.get("costoExtra")),t.xp6(3),t.Q6J("control",e.form.get("total")),t.xp6(4),t.Q6J("control",e.form.get("montoEntregado")),t.xp6(1),t.Q6J("searchable",!0)("clearable",!1),t.xp6(22),t.Q6J("control",e.form.get("cambio")),t.xp6(3),t.Q6J("control",e.form.get("estadoCambio")),t.xp6(1),t.Q6J("searchable",!1)("clearable",!1),t.xp6(8),t.Q6J("type","button")("disabled",e.form.invalid))},dependencies:[L.Np,L.Y5,i._Y,i.Fj,i.JJ,i.JL,V.w9,V.jq,F.z,j.h,Y.f,i.sg,i.u,et.H]}),r})(),nt=(()=>{class r{constructor(){this.onClick=new t.vpe}onClick1(){this.onClick.emit(this.rowData)}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-button"]],inputs:{label:"label",disabled:"disabled",rowData:"rowData"},outputs:{onClick:"onClick"},decls:2,vars:0,consts:[[1,"btn","btn-success","btn-sm","active",3,"click"],["aria-hidden","true",1,"fas","fa-cart-plus"]],template:function(o,e){1&o&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return e.onClick1()}),t._UZ(1,"i",1),t.qZA())},encapsulation:2}),r})(),rt=(()=>{class r{constructor(){this.onClick=new t.vpe}onClick1(){this.onClick.emit(this.rowData)}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-button"]],inputs:{label:"label",disabled:"disabled",rowData:"rowData"},outputs:{onClick:"onClick"},decls:2,vars:0,consts:[[1,"btn","btn-primary","btn-sm","active",3,"click"],["aria-hidden","true",1,"fas","fa-broom"]],template:function(o,e){1&o&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return e.onClick1()}),t._UZ(1,"i",1),t.qZA())},encapsulation:2}),r})();const U=function(r,m,o,e,a){return{"bg-info7":r,"bg-info1":m,"bg-info2":o,"bg-info3":e,"bg-info4":a}},K=function(r,m,o,e){return{"bg-info1":r,"bg-info2":m,"bg-info3":o,"bg-info4":e}},st=function(r,m,o,e,a){return{"badge-soft-pink":r,"bg-info1":m,"bg-info2":o,"bg-info3":e,"bg-info4":a}};let it=(()=>{class r extends f.nh{constructor(o,e,a,n,s,c){super(),this.modalRef=o,this.fb=e,this.datePipe=a,this.reservationsService=n,this.currencyPipe=s,this.bedroomService=c,this.form=new i.cw({}),this.title="SALIDA",this.status="Nuevo",this.edit=!1,this.maxDate=new Date}ngOnInit(){this.prepareForm()}prepareForm(){this.form=this.fb.group({horaEntrada:[null,[i.kI.required]],horaSalida:[null,[i.kI.required]],horaProgramada:[null,[i.kI.required]],costoExtra:[null,[i.kI.pattern(A.K2)]],total:[null,[i.kI.required,i.kI.pattern(A.K2)]],costoHabitacion:[null,[i.kI.required,i.kI.pattern(A.K2)]],montoEntregado:[null,[i.kI.required,i.kI.pattern(A.K2)]],cambio:[null,[i.kI.required]],estadoCambio:[null,[i.kI.required]],deuda:[null,[i.kI.required]]}),this.form.controls.horaEntrada.disable(),this.form.controls.horaProgramada.disable(),this.form.controls.costoExtra.disable(),this.form.controls.costoHabitacion.disable(),this.form.controls.total.disable(),this.form.controls.montoEntregado.disable(),this.form.controls.estadoCambio.disable(),this.form.controls.horaSalida.disable(),null!=this.reservations&&(console.log(this.reservations),this.currentTime(),this.edit=!0,this.timeProgram=this.reservations.horaProgramada,this.timeInput=this.reservations.horaEntrada,this.form.patchValue(this.reservations),this.form.controls.horaSalida.setValue(this.currTime),this.validarHorarioConParametros12Horas(this.timeInput,this.timeProgram),this.time=this.reservations.tiempo,this.extra=this.reservations.costoExtra)}currentTime(){const o=new Date;let e=o.getHours();const n=e>=12?"pm":"am";e=e%12||12;const s=o.getMinutes().toString().padStart(2,"0");this.currTime=`${e}:${s} ${n}`,console.log(this.currTime)}formatToBolivianCurrency(o){return this.currencyPipe.transform(o,"Bs ","symbol","1.2-2")}confirm(){this.updateReservations("SI"==this.changeValid?this.bodyWithChange:this.bodyWithoutChange)}handleSuccess(){this.alert("success",this.title,(this.edit?"Actualizada":"Guardada")+" Correctamente"),this.loading=!1,this.modalRef.content.callback(!0),this.modalRef.hide()}updateReservations(o){this.reservations&&(this.loading=!0,this.reservationsService.update(this.reservations.id,o).subscribe({next:e=>{this.loading=!1,this.updateBedroom("SUCIO")},error:e=>{this.loading=!1}}))}updateBedroom(o){this.reservations&&(this.loading=!0,this.bedroomService.update(this.reservations.habitacionId,{estado:o}).subscribe({next:a=>{this.loading=!1,this.handleSuccess()},error:a=>{this.loading=!1}}))}close(){this.modalRef.hide()}onChange(o){if(console.log(o),o){this.validation=o;const e=this.form.controls.costoHabitacion.value;switch(o){case"1H":if(console.log(this.extra),this.extra){const w=this.addCurrency("Bs 10.00",this.extra),H=this.formatToBolivianCurrency(w);this.form.controls.costoExtra.setValue(H)}else{const T=this.formatToBolivianCurrency(10);this.form.controls.costoExtra.setValue(T)}const n=this.addCurrency(e,this.form.controls.costoExtra.value),s=this.formatToBolivianCurrency(n);if(this.form.controls.total.setValue(s),this.timeOutput){const T=this.addHoursToTime(this.timeOutput,1);this.form.controls.horaSalida.setValue(T)}this.time=this.reservations?.tiempo;break;case"2H":if(this.extra){const w=this.addCurrency("Bs 20.00",this.extra),H=this.formatToBolivianCurrency(w);this.form.controls.costoExtra.setValue(H)}else{const T=this.formatToBolivianCurrency(20);this.form.controls.costoExtra.setValue(T)}const d=this.addCurrency(e,this.form.controls.costoExtra.value),u=this.formatToBolivianCurrency(d);if(this.form.controls.total.setValue(u),this.timeOutput){const T=this.addHoursToTime(this.timeOutput,2);this.form.controls.horaSalida.setValue(T)}this.time=this.reservations?.tiempo;break;default:const b=this.formatToBolivianCurrency(30);this.form.controls.costoExtra.setValue(b);const C=this.form.controls.costoExtra.value;this.form.controls.horaSalida.setValue("12:00 pm");const $=this.addCurrency(e,C),x=this.formatToBolivianCurrency($);this.form.controls.total.setValue(x),this.time="TODA LA NOCHE"}}}addCurrency(o,e){return parseFloat(o.replace("Bs ",""))+parseFloat(e.replace("Bs ",""))}subtractCurrency(o,e){return o>e?parseFloat(o.replace("Bs ",""))-parseFloat(e.replace("Bs ","")):(this.alert("warning","El monto saldra negativo",""),0)}addHoursToTime(o,e){const[a,n]=o.split(" ");let[s,c]=a.split(":").map(Number);"pm"===n.toLowerCase()&&s<12?s+=12:"am"===n.toLowerCase()&&12===s&&(s=0);const d=new Date;d.setHours(s),d.setMinutes(c),d.setHours(d.getHours()+e);let u=d.getHours();const C=u>=12?"pm":"am";return u=u%12||12,`${u}:${d.getMinutes().toString().padStart(2,"0")} ${C}`}onChangeMoney(o){const e=parseInt(o),a=parseInt(this.form.controls.total.value);if(console.log(e,a),e>a){const n=e-a;console.log(n);const s=this.formatToBolivianCurrency(n);this.form.controls.cambio.setValue(s),this.form.controls.estadoCambio.enable(),this.form.controls.estadoCambio.setValue("P")}else{if(e!==a)return this.alert("warning",`El monto ${o} debe ser mayor al total`,""),void this.form.controls.montoEntregado.setValue("");{const n=this.formatToBolivianCurrency(0);this.form.controls.cambio.setValue(n),this.form.controls.estadoCambio.disable(),this.form.controls.estadoCambio.setValue("E")}}}validarHorarioConParametros12Horas(o,e){const a=new Date;let n=a.getHours();const c=n>=12?"pm":"am";n=n%12||12;const u=`${n}:${a.getMinutes().toString().padStart(2,"0")} ${c}`,b=this.convertirHora12a24(e),C=this.convertirHora12a24(o),y=this.convertirHora12a24(u);console.log(b,C,y);const[$,x]=b.split(":").map(Number),[T,w]=C.split(":").map(Number),[H,Ct]=y.split(":").map(Number);let O=new Date,G=new Date,D=new Date;O.setHours($,x,0),G.setHours(T,w,0),D.setHours(H,Ct,0);const vt=this.reservations?.tiempo,Tt=new Date,It=this.reservations?.fecha;if("TODA LA NOCHE"==vt)if(new h.uU("en-EN").transform(It,"dd/MM/yyyy","UTC")==new h.uU("en-EN").transform(Tt,"dd/MM/yyyy","UTC"))this.withoutChange(u);else{const At=this.form.controls.horaSalida.getRawValue();let M=this.contarHorasDespuesDeMediodia(At);console.log(M),0==M?this.withoutChange(u):this.validChange(1==M?10:2==M?20:3==M?30:40)}else if(D>=G&&D<=O)this.withoutChange(u);else if(D>O){const R=(D.getTime()-O.getTime())/36e5;console.log(R),console.log(`Han pasado ${Math.ceil(R)} horas despu\xe9s de las ${e}.`),R<1?(this.validation="1H",this.validChange(10)):R<2?(this.validation="2H",this.validChange(20)):R<3?(this.validation="3H",this.validChange(30)):(this.validation="4H",this.validChange(40))}}convertirHora12a24(o){const[e,a,n]=o.match(/(\d+):(\d+)\s*(AM|PM)/i).slice(1);let s=parseInt(e,10);return"PM"===n.toUpperCase()&&12!==s?s+=12:"AM"===n.toUpperCase()&&12===s&&(s=0),`${s.toString().padStart(2,"0")}:${a}`}validChange(o){const e=this.formatToBolivianCurrency(o);this.form.controls.costoExtra.setValue(e);const a=this.form.controls.cambio.getRawValue(),n=this.form.controls.costoExtra.getRawValue(),s=this.form.controls.total.getRawValue();if("0,00\xa0Bs"!=a){this.changeValid="SI";const c=this.formatToBolivianCurrency(0),d=this.subtractCurrency(a,n);console.log(d);const u=this.formatToBolivianCurrency(d);this.form.controls.cambio.setValue(u);const b=this.addCurrency(n,s),C=this.formatToBolivianCurrency(b);this.form.controls.total.setValue(C),this.form.controls.deuda.setValue(c),setTimeout(()=>{this.alert("warning",`Se debe cambio de ${u}`,"")},500),this.bodyWithChange={horaSalida:this.currentTime(),costoExtra:this.form.controls.costoExtra.getRawValue(),total:this.form.controls.total.getRawValue(),cambio:c,estadoCambio:"E",compania:"SUCIO"}}else{this.changeValid="NO",this.form.controls.deuda.setValue(e);const c=this.addCurrency(n,s),d=this.formatToBolivianCurrency(c);this.form.controls.total.setValue(d),setTimeout(()=>{this.alert("warning",`El cliente debe ${e}`,"")},1e3),this.bodyWithoutChange={horaSalida:this.currentTime(),compania:"SUCIO"}}}withoutChange(o){const e=this.formatToBolivianCurrency(0);this.form.controls.deuda.setValue(e),this.validation="OK";const a=this.form.controls.cambio.getRawValue();"0,00\xa0Bs"!=a?(this.changeValid="SI",setTimeout(()=>{this.alert("warning",`Se debe cambio de ${a}`,"")},500),this.bodyWithChange={horaSalida:o,cambio:e,estadoCambio:"E",compania:"SUCIO"}):(this.changeValid="NO",this.bodyWithoutChange={horaSalida:o,compania:"SUCIO"})}contarHorasDespuesDeMediodia(o){console.log(o);const e=this.convertirHora12a24(o);console.log(e);const[a,n]=e.split(":").map(Number),s=new Date;s.setHours(12,0,0,0);const c=new Date;if(c.setHours(a,n,0,0),console.log(s,c,a,n),c<=s)return 0;const d=(s.getTime()-c.getTime())/36e5;return Math.abs(Math.floor(d))}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(S.UZ),t.Y36(i.qu),t.Y36(h.uU),t.Y36(P.E),t.Y36(h.H9),t.Y36(J.c))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-reservations-modal"]],features:[t.qOj],decls:70,vars:64,consts:[["header",""],[1,"modal-title"],["body",""],[1,"form-material",3,"formGroup"],[1,"row"],[1,"col-md-3"],["label","Hora Entrada",3,"control"],["type","text","formControlName","horaEntrada",1,"form-control"],["label","Hora Programada",3,"control"],["type","text","formControlName","horaProgramada",1,"form-control",3,"ngClass"],["label","Hora Salida",3,"control"],["type","text","formControlName","horaSalida",1,"form-control",3,"ngClass"],["label","Costo Habitacion",3,"control"],["type","text","formControlName","costoHabitacion",1,"form-control",3,"ngClass"],[1,"row","pt-4"],[1,"col-md-4"],["label","Monto Entregado",3,"control"],["formControlName","montoEntregado",1,"form-control",3,"clearable","change"],["value","30,00 Bs"],["value","40,00 Bs"],["value","50,00 Bs"],["value","60,00 Bs"],["value","70,00 Bs"],["value","80,00 Bs"],["value","90,00 Bs"],["value","100,00 Bs"],["value","150,00 Bs"],["value","200,00 Bs"],["label","Cambio",3,"control"],["type","text","formControlName","cambio",1,"form-control",3,"ngClass"],["label","Estado Cambio",3,"control"],["formControlName","estadoCambio",1,"form-control",3,"searchable","clearable"],["value","P"],["value","E"],["label","Costo Extra",3,"control"],["type","text","formControlName","costoExtra",1,"form-control",3,"ngClass"],["label","Deuda Cliente",3,"control"],["type","text","formControlName","deuda",1,"form-control",3,"ngClass"],["label","Total",3,"control"],["type","text","formControlName","total",1,"form-control",3,"ngClass"],["footer",""],[1,"d-flex","justify-content-center"],[1,"m-3"],[3,"type","disabled","confirm"],["type","button",1,"btn","btn-danger","active",3,"click"]],template:function(o,e){1&o&&(t.TgZ(0,"app-modal")(1,"div",0)(2,"h5",1),t._uU(3),t.qZA()(),t.TgZ(4,"div",2)(5,"form",3)(6,"div",4)(7,"div",5)(8,"form-field",6),t._UZ(9,"input",7),t.qZA()(),t.TgZ(10,"div",5)(11,"form-field",8),t._UZ(12,"input",9),t.qZA()(),t.TgZ(13,"div",5)(14,"form-field",10),t._UZ(15,"input",11),t.qZA()(),t.TgZ(16,"div",5)(17,"form-field",12),t._UZ(18,"input",13),t.qZA()()(),t.TgZ(19,"div",14)(20,"div",15)(21,"form-field",16)(22,"ng-select",17),t.NdJ("change",function(n){return e.onChangeMoney(n)}),t.TgZ(23,"ng-option",18),t._uU(24,"30,00 Bs"),t.qZA(),t.TgZ(25,"ng-option",19),t._uU(26,"40,00 Bs"),t.qZA(),t.TgZ(27,"ng-option",20),t._uU(28,"50,00 Bs"),t.qZA(),t.TgZ(29,"ng-option",21),t._uU(30,"60,00 Bs"),t.qZA(),t.TgZ(31,"ng-option",22),t._uU(32,"70,00 Bs"),t.qZA(),t.TgZ(33,"ng-option",23),t._uU(34,"80,00 Bs"),t.qZA(),t.TgZ(35,"ng-option",24),t._uU(36,"90,00 Bs"),t.qZA(),t.TgZ(37,"ng-option",25),t._uU(38,"100,00 Bs"),t.qZA(),t.TgZ(39,"ng-option",26),t._uU(40,"150,00 Bs"),t.qZA(),t.TgZ(41,"ng-option",27),t._uU(42,"200,00 Bs"),t.qZA()()()(),t.TgZ(43,"div",15)(44,"form-field",28),t._UZ(45,"input",29),t.qZA()(),t.TgZ(46,"div",15)(47,"form-field",30)(48,"ng-select",31)(49,"ng-option",32),t._uU(50,"PENDIENTE"),t.qZA(),t.TgZ(51,"ng-option",33),t._uU(52,"ENTREGADO"),t.qZA()()()()(),t.TgZ(53,"div",14)(54,"div",15)(55,"form-field",34),t._UZ(56,"input",35),t.qZA()(),t.TgZ(57,"div",15)(58,"form-field",36),t._UZ(59,"input",37),t.qZA()(),t.TgZ(60,"div",15)(61,"form-field",38),t._UZ(62,"input",39),t.qZA()()()()(),t.TgZ(63,"div",40)(64,"div",41)(65,"div",42)(66,"confirm-button",43),t.NdJ("confirm",function(){return e.confirm()}),t.qZA()(),t.TgZ(67,"div",42)(68,"button",44),t.NdJ("click",function(){return e.close()}),t._uU(69," Cancelar "),t.qZA()()()()()),2&o&&(t.xp6(3),t.Oqu(e.title),t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("control",e.form.get("horaEntrada")),t.xp6(3),t.Q6J("control",e.form.get("horaProgramada")),t.xp6(1),t.Q6J("ngClass",t.qbA(24,U,"OK"===e.validation,"1H"===e.validation,"2H"===e.validation,"3H"===e.validation,"4H"===e.validation)),t.xp6(2),t.Q6J("control",e.form.get("horaSalida")),t.xp6(1),t.Q6J("ngClass",t.qbA(30,U,"OK"===e.validation,"1H"===e.validation,"2H"===e.validation,"3H"===e.validation,"4H"===e.validation)),t.xp6(2),t.Q6J("control",e.form.get("costoHabitacion")),t.xp6(1),t.Q6J("ngClass",t.l5B(36,K,"1H"===e.validation,"2H"===e.validation,"3H"===e.validation,"4H"===e.validation)),t.xp6(3),t.Q6J("control",e.form.get("montoEntregado")),t.xp6(1),t.Q6J("clearable",!1),t.xp6(22),t.Q6J("control",e.form.get("cambio")),t.xp6(1),t.Q6J("ngClass",t.qbA(41,U,"OK"===e.validation,"1H"===e.validation,"2H"===e.validation,"3H"===e.validation,"4H"===e.validation)),t.xp6(2),t.Q6J("control",e.form.get("estadoCambio")),t.xp6(1),t.Q6J("searchable",!1)("clearable",!1),t.xp6(7),t.Q6J("control",e.form.get("costoExtra")),t.xp6(1),t.Q6J("ngClass",t.l5B(47,K,"1H"===e.validation,"2H"===e.validation,"3H"===e.validation,"4H"===e.validation)),t.xp6(2),t.Q6J("control",e.form.get("deuda")),t.xp6(1),t.Q6J("ngClass",t.qbA(52,st,"OK"===e.validation,"1H"===e.validation,"2H"===e.validation,"3H"===e.validation,"4H"===e.validation)),t.xp6(2),t.Q6J("control",e.form.get("total")),t.xp6(1),t.Q6J("ngClass",t.qbA(58,U,"OK"===e.validation,"1H"===e.validation,"2H"===e.validation,"3H"===e.validation,"4H"===e.validation)),t.xp6(4),t.Q6J("type","button")("disabled",e.form.invalid))},dependencies:[h.mk,i._Y,i.Fj,i.JJ,i.JL,V.w9,V.jq,F.z,j.h,Y.f,i.sg,i.u]}),r})();var lt=l(6750),ct=l(8212),mt=l(9219),dt=l(2243),ut=l(4554);const ht=[{path:"",component:(()=>{class r extends f.nh{constructor(o,e,a,n,s){super(),this.modalService=o,this.reservationsService=e,this.authService=a,this.inChargeService=n,this.bedroomService=s,this.data=new E.nC,this.params=new Z.X(new g.NV),this.data1=[],this.columnFilters=[],this.totalItems=0,this.infoUser=0,this.settings={...this.settings,hideSubHeader:!1,actions:{columnTitle:"Acciones",edit:!0,delete:!0,add:!1,position:"right"},columns:{officialConclusion:{title:"Aseo",width:"5%",type:"custom",sort:!1,filter:!1,renderComponent:rt,onComponentInitFunction:c=>{c.onClick.subscribe(d=>{this.increase(d)})}},officialConclusion1:{title:"Venta",width:"5%",type:"custom",sort:!1,filter:!1,renderComponent:nt,onComponentInitFunction:c=>{c.onClick.subscribe(d=>{this.sales(d)})}},officialConclusion2:{title:"Salida",width:"5%",type:"custom",sort:!1,filter:!1,renderComponent:lt.N,onComponentInitFunction:c=>{c.onClick.subscribe(d=>{this.output(d)})}},...z},rowClassFunction:c=>{switch(c.data.compania){case"OCUPADO":return"bg-danger1";case"LIBRE":return"bg-success1";case"SUCIO":return"bg-warning1";default:return"bg-light text-black"}}}}ngOnInit(){this.getUser(),this.data.onChanged().pipe((0,v.R)(this.$unSubscribe)).subscribe(o=>{"filter"===o.action&&(o.filter.filters.map(a=>{let n="",s=g.ay.ILIKE;switch(n=`filter.${a.field}`,a.field){case"id":case"precio":s=g.ay.EQ;break;case"clientes":s=g.ay.ILIKE,n=`filter.${a.field}.nombre`;break;default:s=g.ay.ILIKE}""!==a.search?this.columnFilters[n]=`${s}:${a.search}`:delete this.columnFilters[n]}),this.params=this.pageFilter(this.params),this.getAllReservations())}),this.params.pipe((0,v.R)(this.$unSubscribe)).subscribe(()=>this.getAllReservations())}getUser(){const o=this.authService.getUserInfo();this.infoUser=o.id}validInCharge(o){var e=this;return(0,p.Z)(function*(){const a=new g.NV;return a["filter.userId"]=`$eq:${o}`,new Promise((n,s)=>{e.inChargeService.getAll(a).subscribe({next:c=>{n(c)},error:c=>{n(0)}})})})()}increase(o){if(console.log(o.horaSalida),o.horaSalida&&"LIBRE"==o.compania)this.alert("success","Limpieza registrada satisfactoriamente.","");else if(o.horaSalida){let e=o.habitaciones;this.alertQuestion("warning",`\xbfLa habitaci\xf3n  No. ${e.noHabitacion} ${e.preferencias} esta limpio?`,"","SI, ya esta","NO, falta").then(a=>{a.isConfirmed&&(this.updateBedroom("LIBRE",o.habitacionId),this.updateReservation(o.id),this.params.pipe((0,v.R)(this.$unSubscribe)).subscribe(()=>this.getAllReservations()))})}else{let e=o.habitaciones;this.alert("warning",`La habitacion ${e.noHabitacion} - ${e.preferencias} sigue OCUPADO`,"")}}openModalIncrease(o){this.modalService.show(it,{initialState:{reservations:o,callback:a=>{a&&this.getAllReservations()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}sales(o){console.log(o),this.openModalSales(o)}openModalSales(o){this.modalService.show(ct.f,{initialState:{reservations:o,callback:a=>{a&&this.getAllReservations()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}output(o){if(console.log(o),o.horaSalida)this.alert("success","Ya se regisro la hora de salida","");else{let e=this.currentTime();const a=new Date;if(new h.uU("en-EN").transform(o.fecha,"dd/MM/yyyy","UTC")==new h.uU("en-EN").transform(a,"dd/MM/yyyy","UTC"))this.openModalIncrease(o);else{const c=this.contarHorasDespuesDeMediodia(e,o.horaProgramada);if(c>4)this.alertQuestion("warning","El cliente se paso mas de 4 Horas \xbfse le asigara un dia mas?","").then(d=>{d.isConfirmed&&(this.updateBedroom("LIBRE",o.habitacionId),this.params.pipe((0,v.R)(this.$unSubscribe)).subscribe(()=>this.getAllReservations()),this.openModal())});else if(c<=4)this.openModalIncrease(o);else{if(0==this.contarHorasDespuesDeMediodia(e,o.horaEntrada))return void this.alert("error",`Fuera de rango de horarios ${e} debe ser mayor a ${o.horaEntrada}`,"");this.openModalIncrease(o)}}}}currentTime(){const o=new Date;let e=o.getHours();const n=e>=12?"pm":"am";return e=e%12||12,`${e}:${o.getMinutes().toString().padStart(2,"0")} ${n}`}contarHorasDespuesDeMediodia(o,e){console.log(o);const a=this.convertirHora12a24(o),n=this.convertirHora12a24(e);console.log(a);const[s,c]=a.split(":").map(Number),[d,u]=n.split(":").map(Number),b=new Date;b.setHours(d,u,0,0);const C=new Date;if(C.setHours(s,c,0,0),console.log(b,C,s,c),C<=b)return 0;const y=(b.getTime()-C.getTime())/36e5;return Math.abs(Math.floor(y))}convertirHora12a24(o){const[e,a,n]=o.match(/(\d+):(\d+)\s*(AM|PM)/i).slice(1);let s=parseInt(e,10);return"PM"===n.toUpperCase()&&12!==s?s+=12:"AM"===n.toUpperCase()&&12===s&&(s=0),`${s.toString().padStart(2,"0")}:${a}`}getAllReservations(){var o=this;return(0,p.Z)(function*(){o.loading=!0;let e=yield o.validInCharge(o.infoUser);o.idInCharge=e.data[0].alojamientoId;let a={...o.params.getValue(),...o.columnFilters};console.log(o.idInCharge),a["filter.alojamientoId"]=`$eq:${o.idInCharge}`,o.reservationsService.getAll(a).subscribe({next:n=>{console.log(n),o.data.load(n.data),o.data.refresh(),o.totalItems=n.count,o.loading=!1},error:n=>{o.loading=!1,o.data.load([])}})})()}edit(o){this.openModal(o)}openModal(o){this.modalService.show(at,{initialState:{reservations:o,callback:a=>{a&&this.getAllReservations()}},class:"modal-lg modal-dialog-centered",ignoreBackdropClick:!0})}showDeleteAlert(o){this.alertQuestion("warning","Eliminar","\xbfDesea eliminar este registro?").then(e=>{e.isConfirmed&&this.delete(o.id)})}delete(o){this.reservationsService.remove(o).subscribe({next:()=>{this.alert("success","RESERVACI\xd3N","Borrado Correctamente"),this.params.pipe((0,v.R)(this.$unSubscribe)).subscribe(()=>this.getAllReservations())},error:e=>{this.alert("error","No se logro Eliminar","Existe una relacion")}})}updateBedroom(o,e){this.loading=!0,this.bedroomService.update(e,{estado:o}).subscribe({next:n=>{this.loading=!1},error:n=>{this.loading=!1}})}updateReservation(o){this.reservationsService.update(o,{compania:"LIBRE"}).subscribe({next:a=>{this.loading=!1},error:a=>{this.loading=!1}})}convertdate(o){const e=new Date(o);return`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(S.tT),t.Y36(P.E),t.Y36(Q.e),t.Y36(q.t),t.Y36(J.c))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-reservations-list"]],features:[t.qOj],decls:33,vars:10,consts:[[3,"header"],["header","",1,"ch-content"],[1,"title"],["body",""],[1,"row"],[1,"col-md-6","mb-3","justify-content-center"],[1,"col-md-4"],[1,"badge","bg-danger1","text-black","d-flex"],[1,"badge","bg-warning1","text-black","d-flex"],[1,"badge","bg-success1","text-black","d-flex"],[1,"col-md-2","mb-3"],[1,"col-md-4","text-end","d-flex","flex-row-reverse","mb-3"],[1,"mr-3"],["type","button","tooltip","Nuevo","containerclass","tooltip-style",1,"btn","btn-info","btn-sm","active","d-flex","justify-content-center","align-items-center","ml-3",3,"click"],[1,"bx","bx-plus","bx-sm","ml-2"],[3,"defaultColumns","settings","leftList","settingsChange"],[1,"col-md-12"],[1,"table-responsive"],[3,"settings","source","edit","delete"],[3,"params","totalItems"]],template:function(o,e){1&o&&(t.TgZ(0,"app-card",0)(1,"div",1)(2,"h5",2),t._uU(3,"RESERVACI\xd3NES"),t.qZA()(),t.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",4)(8,"div",6)(9,"span",7)(10,"h3"),t._uU(11,"OCUPADO"),t.qZA()()(),t.TgZ(12,"div",6)(13,"span",8)(14,"h3"),t._uU(15,"SUCIO"),t.qZA()()(),t.TgZ(16,"div",6)(17,"span",9)(18,"h3"),t._uU(19,"LIBRE"),t.qZA()()()()(),t._UZ(20,"div",10),t.TgZ(21,"div",11)(22,"div",12)(23,"button",13),t.NdJ("click",function(){return e.openModal()}),t._uU(24," Nuevo "),t._UZ(25,"i",14),t.qZA()(),t.TgZ(26,"app-columns-select",15),t.NdJ("settingsChange",function(n){return e.settings=n}),t.qZA()()(),t.TgZ(27,"div",4)(28,"div",16)(29,"div")(30,"div",17)(31,"ng2-smart-table",18),t.NdJ("edit",function(n){return e.edit(n.data)})("delete",function(n){return e.showDeleteAlert(n.data)}),t.qZA()(),t._UZ(32,"app-pagination",19),t.qZA()()()()()),2&o&&(t.Q6J("header",!0),t.xp6(26),t.Q6J("defaultColumns",12)("settings",e.settings)("leftList",!0),t.xp6(3),t.Tol(e.loading?"table-loading":""),t.xp6(2),t.Q6J("settings",e.settings)("source",e.data),t.xp6(1),t.Q6J("params",e.params)("totalItems",e.totalItems))},dependencies:[mt.A,dt.L,E.T5,ut.Q]}),r})()}];let ft=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[B.Bz.forChild(ht),B.Bz]}),r})();var gt=l(8909),pt=l(6776);let bt=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[h.ez,gt.m8,S.zk.forChild(),ft,pt.Db.forRoot()]}),r})()},6750:(k,_,l)=>{l.d(_,{N:()=>B});var h=l(1571);let B=(()=>{class p{constructor(){this.onClick=new h.vpe}onClick1(){this.onClick.emit(this.rowData)}}return p.\u0275fac=function(Z){return new(Z||p)},p.\u0275cmp=h.Xpm({type:p,selectors:[["app-button"]],inputs:{label:"label",disabled:"disabled",rowData:"rowData"},outputs:{onClick:"onClick"},decls:2,vars:0,consts:[[1,"btn","btn-primary","btn-sm","active",3,"click"],["aria-hidden","true",1,"fas","fa-hand-point-right"]],template:function(Z,v){1&Z&&(h.TgZ(0,"button",0),h.NdJ("click",function(){return v.onClick1()}),h._UZ(1,"i",1),h.qZA())},encapsulation:2}),p})()}}]);